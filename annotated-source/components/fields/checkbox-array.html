<!DOCTYPE html><html lang="en"><head><title>components/fields/checkbox-array</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="components/fields/checkbox-array"><meta name="groc-project-path" content="lib/components/fields/checkbox-array.js"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">lib/components/fields/checkbox-array.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="checkbox-array-component">checkbox-array component</h1></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Used with array values to supply multiple checkboxes for adding multiple
enumerated values to an array.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-pi">
'use strict'</span>;

<span class="hljs-keyword">var</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">'react'</span>);
<span class="hljs-keyword">var</span> R = React.DOM;
<span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>);
<span class="hljs-keyword">var</span> cx = React.addons.classSet;

module.exports = React.createClass({

  displayName: <span class="hljs-string">'CheckboxArray'</span>,

  mixins: [<span class="hljs-built_in">require</span>(<span class="hljs-string">'../../mixins/field'</span>)],

  getInitialState: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> {
      choices: <span class="hljs-keyword">this</span>.props.config.fieldChoices(<span class="hljs-keyword">this</span>.props.field)
    };
  },

  componentWillReceiveProps: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newProps)</span> {</span>
    <span class="hljs-keyword">this</span>.setState({
      choices: newProps.config.fieldChoices(newProps.field)
    });
  },

  onChange: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get all the checked checkboxes and convert to an array of values.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> choiceNodes = <span class="hljs-keyword">this</span>.refs.choices.getDOMNode().getElementsByTagName(<span class="hljs-string">'input'</span>);
    choiceNodes = <span class="hljs-built_in">Array</span>.prototype.slice.call(choiceNodes, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">var</span> values = choiceNodes.map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(node)</span> {</span>
      <span class="hljs-keyword">return</span> node.checked ? node.value : <span class="hljs-literal">null</span>;
    }).filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
      <span class="hljs-keyword">return</span> value;
    });
    <span class="hljs-keyword">this</span>.onChangeValue(values);
  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.renderWithConfig();
  },

  renderDefault: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>.props.config;
    <span class="hljs-keyword">var</span> field = <span class="hljs-keyword">this</span>.props.field;

    <span class="hljs-keyword">var</span> choices = <span class="hljs-keyword">this</span>.state.choices || [];

    <span class="hljs-keyword">var</span> isInline = !_.find(choices, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(choice)</span> {</span>
      <span class="hljs-keyword">return</span> choice.sample;
    });

    <span class="hljs-keyword">return</span> config.createElement(<span class="hljs-string">'field'</span>, {
      field: field
    },
      R.div({className: cx(<span class="hljs-keyword">this</span>.props.classes), ref: <span class="hljs-string">'choices'</span>},
        choices.map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(choice, i)</span> {</span>

          <span class="hljs-keyword">var</span> inputField = R.span({style: {whiteSpace: <span class="hljs-string">'nowrap'</span>}},
            R.input({
              name: field.key,
              type: <span class="hljs-string">'checkbox'</span>,
              value: choice.value,
              checked: field.value.indexOf(choice.value) &gt;= <span class="hljs-number">0</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>,
              onChange: <span class="hljs-keyword">this</span>.onChange,
              onFocus: <span class="hljs-keyword">this</span>.onFocusAction,
              onBlur: <span class="hljs-keyword">this</span>.onBlurAction
            }),
            <span class="hljs-string">' '</span>,
            R.span({className: <span class="hljs-string">'field-choice-label'</span>},
              choice.label
            )
          );

          <span class="hljs-keyword">if</span> (isInline) {
            <span class="hljs-keyword">return</span> R.span({key: i, className: <span class="hljs-string">'field-choice'</span>},
              inputField, <span class="hljs-string">' '</span>
            );
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> R.div({key: i, className: <span class="hljs-string">'field-choice'</span>},
              inputField, <span class="hljs-string">' '</span>,
              config.createElement(<span class="hljs-string">'sample'</span>, {field: field, choice: choice})
            );
          }
        }.bind(<span class="hljs-keyword">this</span>))
      )
    );
  }
});</div></div></div></div></body></html>