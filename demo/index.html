<!DOCTYPE html>
<html>
<head>
  <link href="./style/formatic.css" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="./bower_components/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="./bower_components/bootstrap/dist/css/bootstrap-theme.min.css">
</head>
<body>
  <div class="container-fluid">
    <div id="user"></div>
    <div id="extra"></div>
    <div id="json"></div>
    <div style="height:200px"></div>
  </div>

  <script src="./bower_components/jquery/dist/jquery.min.js"></script>
  <script src="./bower_components/underscore/underscore-min.js"></script>
  <script src="./bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="./bower_components/react/react-with-addons.js"></script>

  <script src="./lib/formatic.js"></script>
  <script>

    var R = React.DOM;

    var Form = React.createFactory(Formatic);

    var config = Formatic.createConfig(Formatic.plugins.bootstrap);

    var fields = [
      {label: 'Name', type: 'unicode', key: 'name'},
      {id: 'silly', type: 'copy', help_text_html: 'What the hey?'},
      {label: 'Note', type: 'text', key: 'note'},
      {label: 'Mood', type: 'select', key: 'mood', choices: ['happy', 'sad']},
      {label: 'Groceries', type: 'pretty-textarea', key: 'groceries', replaceChoices: ['tacos', 'nachos', 'bread', 'milk', 'eggs']},
      {
        label: 'Robots', type: 'list', key: 'robots',
        items: [{
          label: 'Simple',
          match: {type: 'simple'},
          type: 'fields',
          fields: [
            {label: 'Name', type: 'unicode', key: 'name'}
          ]
        },{
          label: 'Complex',
          match: {type: 'complex'},
          type: 'fields',
          fields: [
            {label: 'Name', type: 'unicode', key: 'name'},
            {label: 'Description', type: 'text', key: 'description'}
          ]
        }]
      },
      {label: 'Mapping', type: 'object', key: 'mapping'},
      {label: 'The Blob', type: 'json', key: 'blob'},
      {label: 'Do you like cookies?', type: 'boolean', key: 'likesCookies'}
    ];

    var formValue = {};

    var createField = config.createField;

    config.createField = function (props) {
      var config = this;

      if (props.field.id === 'silly' && formValue.name === 'Joe') {
        props = _.extend({}, props);
        field = _.extend({}, props.field);
        field.help_text_html = 'What a nice name!';
        props.field = field;
      }

      return createField.call(config, props);
    };

    var renderFieldComponent = config.renderFieldComponent;

    config.renderFieldComponent = function (component) {
      var config = this;

      return R.div({style: {border: 'red solid 2px'}},
        renderFieldComponent.call(config, component)
      );
    };

    config.renderComponent_Text = function (component) {
      var config = this;

      return R.div({style: {border: 'blue solid 2px'}},
        component.renderDefault()
      );
    };

    //console.log(config);

    // Controlled version:

    var render = function (value) {
      React.render(Form({
        config: config,
        fields: fields,
        value: value,
        onChange: function (newValue, info) {
          console.log(newValue, info);
          formValue = newValue;
          render(newValue);
        }
      }), document.getElementById('user'));
    };

    var setValue = function (value) {
      value = value;
      render(value);
    };

    setValue(formValue);

    // Uncontrolled version:

    // React.render(Form({
    //   config: config,
    //   fields: fields,
    //   defaultValue: {},
    //   onChange: function (newValue, info) {
    //     console.log(newValue, info);
    //     formValue = newValue;
    //   }
    // }), document.getElementById('user'));
  </script>
</body>
</html>
