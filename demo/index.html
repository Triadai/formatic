<!DOCTYPE html>
<html>
<head>
  <link href="./style/formatic.css" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="./bower_components/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="./bower_components/bootstrap/dist/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="./bower_components/codemirror/lib/codemirror.css">

  <style type="text/css" media="screen">
   /* CodeMirror styling */
   .CodeMirror {
     /* Set height, width, borders, and global font properties here */
     font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
   }

   /* PADDING */
   .CodeMirror-lines {
     padding: 0 0; /* Vertical padding around content */
   }
   .CodeMirror pre {
     padding: 0 0; /* Horizontal padding of content */
   }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div id="user"></div>
    <div id="extra"></div>
    <div id="json"></div>
    <div style="height:200px"></div>
  </div>

  <script src="./bower_components/jquery/dist/jquery.min.js"></script>
  <script src="./bower_components/underscore/underscore-min.js"></script>
  <script src="./bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="./bower_components/codemirror/lib/codemirror.js"></script>
  <script src="./bower_components/react/react-with-addons.js"></script>

  <script src="./lib/formatic-dev.js"></script>
  <script>

    var R = React.DOM;

    var Form = React.createFactory(Formatic);

    var config = Formatic.createConfig(
      Formatic.plugins.reference,
      Formatic.plugins.meta,
      Formatic.plugins.bootstrap
    );

    var fields = [];

    var prettyNum = 10;
    _.each(_.range(prettyNum), function(x){
      fields.push({
        label: 'Pretty Text 2', key: 'prettyText2-' + x, type: 'pretty-text2',
        default: 'Hi there {{firstName}} {{lastName}} {{middleName}}',
        tabIndex: 1,
        replaceChoices: [
          {
            value: 'firstName',
            label: 'First Name',
            sample: 'Bob'
          },
          {
            value: 'lastName',
            label: 'Last Name',
            sample: 'Smith'
          }
        ]
      });
    });

    fields = fields.concat([
      {label: 'Name', type: 'unicode', key: 'name', required: true, default: 'Unknown'},
      {id: 'silly', type: 'copy', help_text_html: 'What the hey?'},
      {label: 'Note', type: 'text', key: 'note'},
      {label: 'Mood', type: 'select', key: 'mood', choices: ['happy', 'sad']},
      {label: 'Groceries', type: 'text', key: 'groceries', replaceChoices: ['tacos', 'nachos', 'bread', 'milk', 'eggs']},
      {label: 'Path', type: 'unicode', key: 'path', replaceChoices: ['tacos', 'nachos', 'bread', 'milk', 'eggs']},
      {
        label: 'Robots', type: 'list', key: 'robots',
        itemFields: [{
          label: 'Simple',
          match: {type: 'simple'},
          type: 'fields',
          fields: [
            {label: 'Name', type: 'unicode', key: 'name'}
          ]
        },{
          label: 'Complex',
          match: {type: 'complex'},
          type: 'fields',
          fields: [
            {label: 'Name', type: 'unicode', key: 'name'},
            {label: 'Description', type: 'text', key: 'description'}
          ]
        }]
      },
      {label: 'Mapping', type: 'object', key: 'mapping'},
      {label: 'The Blob', type: 'json', key: 'blob'},
      {label: 'Do you like cookies?', type: 'boolean', key: 'likesCookies'},
      {label: 'Colors', type: 'checkbox-list', key: 'colors', choices: ['red', 'green', 'blue']},
      {label: 'Junk', type: 'junk'},
      {
        label: 'Folder',
        type: 'fields',
        key: 'folder',
        match: {type: 'folder'},
        fields: [
          {type: 'unicode', key: 'type', hidden: true, default: 'folder'},
          {label: 'Name', type: 'unicode', key: 'name'},
          {
            label: 'Children',
            type: 'array',
            key: 'children',
            itemFields: [
              {
                label: 'File',
                type: 'fields',
                match: {type: 'file'},
                fields: [
                  {type: 'unicode', key: 'type', hidden: true, default: 'file'},
                  {label: 'Name', type: 'unicode', key: 'name'},
                  {label: 'Content', type: 'text', key: 'content'}
                ]
              },
              'folder'
            ]
          }
        ]
      },
      {label: 'More colors', key: 'moreColors', extends: 'colors'},
      {label: 'Alive', label: "I'm alive!", type: 'checkbox-boolean', key: 'isAlive'}
    ]);

    var formValue = {};

    var initField = config.initField;

    config.initField = function (field) {

      initField.apply(this, arguments);

      if (field.id === 'silly') {

        if ((field.parent.value.name || '').toLowerCase() === 'joe') {
          field.help_text_html = field.meta.msg;
        }
      }
    };

    // var createField = config.createField;
    //
    // config.createField = function (props) {
    //   var config = this;
    //
    //   if (props.field.id === 'silly' && formValue.name === 'Joe') {
    //     props = _.extend({}, props);
    //     field = _.extend({}, props.field);
    //     field.help_text_html = 'What a nice name!';
    //     props.field = field;
    //   }
    //
    //   return createField.call(config, props);
    // };

    // var renderFieldComponent = config.renderFieldComponent;
    //
    // config.renderFieldComponent = function (component) {
    //   var config = this;
    //
    //   return R.div({style: {border: '#ccc solid 2px'}},
    //     renderFieldComponent.call(config, component)
    //   );
    // };
    //
    // config.renderComponent_Text = function (component) {
    //   var config = this;
    //
    //   return R.div({style: {border: 'blue solid 2px'}},
    //     component.renderDefault()
    //   );
    // };

    //console.log(config);

    var onFocus = function (event) {
      console.log('focus:', event.path, event.field);
    };

    var onBlur = function (event) {
      console.log('blur:', event.path, event.field);
    };

    var onOpenReplacements = function (info) {
      console.log('opening replacements:', info);
    }

    var onCloseReplacements = function (info) {
      console.log('closing replacements:', info);
    }

    // Controlled version:

    var render = function (value) {
      React.render(Form({
        meta: {msg: "That's a fine name you have there!"},
        config: config,
        fields: fields,
        value: value,
        onChange: function (newValue, info) {
          console.log('changed at:', info.path);
          console.log('new value:', newValue);
          formValue = newValue;
          render(newValue);
        },
        onFocus: onFocus,
        onBlur: onBlur,
        onOpenReplacements: onOpenReplacements,
        onCloseReplacements: onCloseReplacements
      }), document.getElementById('user'));
    };

    var setValue = function (value) {
      formValue = value;
      render(formValue);
    };

    setValue(formValue);

    // Uncontrolled version:

    // React.render(Form({
    //   config: config,
    //   fields: fields,
    //   defaultValue: {},
    //   onChange: function (newValue, info) {
    //     console.log(newValue, info);
    //     formValue = newValue;
    //   }
    // }), document.getElementById('user'));
  </script>
</body>
</html>
