<!DOCTYPE html><html lang="en"><head><title>default-config</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="default-config"><meta name="groc-project-path" content="lib/default-config.js"><meta name="groc-github-url" content="https://github.com/zapier/formatic"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/zapier/formatic/blob/master/lib/default-config.js">lib/default-config.js</a></div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="default-config">default-config</h1></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is the default configuration for formatic. It&#39;s just an object with a bunch
of behavior functions that are passed into all the components. So to change
formatic&#39;s behavior, it&#39;s simple matter of cloning this object and overriding
the methods.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-pi">
'use strict'</span>;

<span class="hljs-keyword">var</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">'react/addons'</span>);
<span class="hljs-keyword">var</span> R = React.DOM;
<span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>);

<span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./utils'</span>);

module.exports = {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Field element factories. Create field elements.</p></div></div><div class="code"><div class="wrapper">  createElement_Fields: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/fields/fields'</span>)),

  createElement_String: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/fields/string'</span>)),

  createElement_SingleLineString: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/fields/single-line-string'</span>)),

  createElement_Select: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/fields/select'</span>)),

  createElement_Boolean: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/fields/boolean'</span>)),

  createElement_PrettyText: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/fields/pretty-text'</span>)),

  createElement_Array: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/fields/array'</span>)),

  createElement_CheckboxList: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/fields/checkbox-list'</span>)),

  createElement_Object: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/fields/object'</span>)),

  createElement_Json: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/fields/json'</span>)),

  createElement_UnknownField: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/fields/unknown'</span>)),

  createElement_Copy: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/fields/copy'</span>)),</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Other element factories. Create helper elements used by field components.</p></div></div><div class="code"><div class="wrapper">  createElement_Field: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/field'</span>)),

  createElement_Label: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/label'</span>)),

  createElement_Help: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/help'</span>)),

  createElement_Choices: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/choices'</span>)),

  createElement_ArrayControl: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/array-control'</span>)),

  createElement_ArrayItemControl: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/array-item-control'</span>)),

  createElement_ArrayItemValue: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/array-item-value'</span>)),

  createElement_ArrayItem: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/array-item'</span>)),

  createElement_FieldTemplateChoices: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/field-template-choices'</span>)),

  createElement_AddItem: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/add-item'</span>)),

  createElement_RemoveItem: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/remove-item'</span>)),

  createElement_MoveItemForward: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/move-item-forward'</span>)),

  createElement_MoveItemBack: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/move-item-back'</span>)),

  createElement_ObjectControl: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/object-control'</span>)),

  createElement_ObjectItemControl: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/object-item-control'</span>)),

  createElement_ObjectItemValue: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/object-item-value'</span>)),

  createElement_ObjectItemKey: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/object-item-key'</span>)),

  createElement_ObjectItem: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/object-item'</span>)),

  createElement_SelectValue: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/select-value'</span>)),

  createElement_Sample: React.createFactory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./components/helpers/sample'</span>)),</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Field default value factories. Give a default value for a specific type.</p></div></div><div class="code"><div class="wrapper">  createDefaultValue_String: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/* fieldTemplate */</span>)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
  },

  createDefaultValue_Object: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/* fieldTemplate */</span>)</span> {</span>
    <span class="hljs-keyword">return</span> {};
  },

  createDefaultValue_Array: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/* fieldTemplate */</span>)</span> {</span>
    <span class="hljs-keyword">return</span> [];
  },

  createDefaultValue_Boolean: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/* fieldTemplate */</span>)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  },

  createDefaultValue_Fields: utils.delegateTo(<span class="hljs-string">'createDefaultValue_Object'</span>),

  createDefaultValue_SingleLineString: utils.delegateTo(<span class="hljs-string">'createDefaultValue_String'</span>),

  createDefaultValue_Select: utils.delegateTo(<span class="hljs-string">'createDefaultValue_String'</span>),

  createDefaultValue_Json: utils.delegateTo(<span class="hljs-string">'createDefaultValue_Object'</span>),

  createDefaultValue_CheckboxList: utils.delegateTo(<span class="hljs-string">'createDefaultValue_Array'</span>),</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Field value coercers. Coerce a value into a value appropriate for a specific type.</p></div></div><div class="code"><div class="wrapper">  coerceValue_String: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate, value)</span> {</span>
    <span class="hljs-keyword">if</span> (_.isString(value)) {
      <span class="hljs-keyword">return</span> value;
    }
    <span class="hljs-keyword">if</span> (_.isUndefined(value) || value === <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(value);
  },

  coerceValue_Object: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate, value)</span> {</span>
    <span class="hljs-keyword">if</span> (!_.isObject(value)) {
      <span class="hljs-keyword">return</span> {};
    }
    <span class="hljs-keyword">return</span> value;
  },

  coerceValue_Array: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate, value)</span> {</span>
    <span class="hljs-keyword">if</span> (!_.isArray(value)) {
      <span class="hljs-keyword">return</span> [value];
    }
    <span class="hljs-keyword">return</span> value;
  },

  coerceValue_Boolean: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate, value)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.coerceValueToBoolean(value);
  },

  coerceValue_Fields: utils.delegateTo(<span class="hljs-string">'coerceValue_Object'</span>),

  coerceValue_SingleLineString: utils.delegateTo(<span class="hljs-string">'coerceValue_String'</span>),

  coerceValue_Select: utils.delegateTo(<span class="hljs-string">'coerceValue_String'</span>),

  coerceValue_Json: utils.delegateTo(<span class="hljs-string">'coerceValue_Object'</span>),

  coerceValue_CheckboxList: utils.delegateTo(<span class="hljs-string">'coerceValue_Array'</span>),</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Field child fields factories, so some types can have dynamic children.</p></div></div><div class="code"><div class="wrapper">  createChildFields_Array: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">return</span> field.value.map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(arrayItem, i)</span> {</span>
      <span class="hljs-keyword">var</span> childFieldTemplate = config.childFieldTemplateForValue(field, arrayItem);

      <span class="hljs-keyword">var</span> childField = config.createChildField(field, {
        fieldTemplate: childFieldTemplate, key: i, fieldIndex: i, value: arrayItem
      });

      <span class="hljs-keyword">return</span> childField;
    });
  },

  createChildFields_Object: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.keys(field.value).map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key, i)</span> {</span>
      <span class="hljs-keyword">var</span> childFieldTemplate = config.childFieldTemplateForValue(field, field.value[key]);

      <span class="hljs-keyword">var</span> childField = config.createChildField(field, {
        fieldTemplate: childFieldTemplate, key: key, fieldIndex: i, value: field.value[key]
      });

      <span class="hljs-keyword">return</span> childField;
    });
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Check if there is a factory for the name.</p></div></div><div class="code"><div class="wrapper">  hasElementFactory: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">return</span> config[<span class="hljs-string">'createElement_'</span> + name] ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Create an element given a name, props, and children.</p></div></div><div class="code"><div class="wrapper">  createElement: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, props, children)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">if</span> (!props.config) {
      props = _.extend({}, props, {config: config});
    }

    name = config.elementName(name);

    <span class="hljs-keyword">if</span> (config[<span class="hljs-string">'createElement_'</span> + name]) {
      <span class="hljs-keyword">return</span> config[<span class="hljs-string">'createElement_'</span> + name](props, children);
    }

    <span class="hljs-keyword">if</span> (name !== <span class="hljs-string">'Unknown'</span>) {
      <span class="hljs-keyword">if</span> (config.hasElementFactory(<span class="hljs-string">'Unknown'</span>)) {
        <span class="hljs-keyword">return</span> config.createElement(<span class="hljs-string">'Unknown'</span>, props, children);
      }
    }

    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Factory not found for: '</span> + name);
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Create a field element given some props. Use context to determine name.</p></div></div><div class="code"><div class="wrapper">  createFieldElement: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(props)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> name = config.fieldTypeName(props.field);

    <span class="hljs-keyword">if</span> (config.hasElementFactory(name)) {
      <span class="hljs-keyword">return</span> config.createElement(name, props);
    }

    <span class="hljs-keyword">return</span> config.createElement(<span class="hljs-string">'UnknownField'</span>, props);
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Render the root formatic component</p></div></div><div class="code"><div class="wrapper">  renderFormaticComponent: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(component)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> props = component.props;

    <span class="hljs-keyword">var</span> field = config.createRootField(props);

    <span class="hljs-keyword">return</span> R.div({className: <span class="hljs-string">'formatic'</span>},
      config.createFieldElement({field: field, onChange: component.onChange, onAction: component.onAction})
    );
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Render any component.</p></div></div><div class="code"><div class="wrapper">  renderComponent: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(component)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> name = component.constructor.displayName;

    <span class="hljs-keyword">if</span> (config[<span class="hljs-string">'renderComponent_'</span> + name]) {
      <span class="hljs-keyword">return</span> config[<span class="hljs-string">'renderComponent_'</span> + name](component);
    }

    <span class="hljs-keyword">return</span> component.renderDefault();
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Render field components.</p></div></div><div class="code"><div class="wrapper">  renderFieldComponent: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(component)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">return</span> config.renderComponent(component);
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Normalize an element name.</p></div></div><div class="code"><div class="wrapper">  elementName: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> {</span>
    <span class="hljs-keyword">return</span> utils.dashToPascal(name);
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Type aliases.</p></div></div><div class="code"><div class="wrapper">  alias_Dict: <span class="hljs-string">'Object'</span>,

  alias_Bool: <span class="hljs-string">'Boolean'</span>,

  alias_PrettyTextarea: <span class="hljs-string">'PrettyText'</span>,

  alias_SingleLineString: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate)</span> {</span>
    <span class="hljs-keyword">if</span> (fieldTemplate.replaceChoices) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'PrettyText'</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fieldTemplate.choices) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'Select'</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">'SingleLineString'</span>;
  },

  alias_String: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">if</span> (fieldTemplate.replaceChoices) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'PrettyText'</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fieldTemplate.choices) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'Select'</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (config.fieldTemplateIsSingleLine(fieldTemplate)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'SingleLineString'</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">'String'</span>;
  },

  alias_Text: utils.delegateTo(<span class="hljs-string">'alias_String'</span>),

  alias_Unicode: utils.delegateTo(<span class="hljs-string">'alias_SingleLineString'</span>),

  alias_Str: utils.delegateTo(<span class="hljs-string">'alias_SingleLineString'</span>),

  alias_List: <span class="hljs-string">'Array'</span>,

  alias_Fieldset: <span class="hljs-string">'Fields'</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Field factory</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Given a field, expand all child fields recursively to get the default
values of all fields.</p></div></div><div class="code"><div class="wrapper">  inflateFieldValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">if</span> (config.fieldHasValueChildren(field)) {
      <span class="hljs-keyword">var</span> value = _.clone(field.value);
      <span class="hljs-keyword">var</span> childFields = config.createChildFields(field);
      childFields.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(childField)</span> {</span>
        <span class="hljs-keyword">if</span> (config.isKey(childField.key)) {
          value[childField.key] = config.inflateFieldValue(childField);
        }
      });
      <span class="hljs-keyword">return</span> value;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> field.value;
    }
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Initialize the root field.</p></div></div><div class="code"><div class="wrapper">  initRootField: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/* field, props */</span>)</span> {</span>
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Initialize every field.</p></div></div><div class="code"><div class="wrapper">  initField: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/* field */</span>)</span> {</span>
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>If an array of field templates are passed in, this method is used to
wrap the fields inside a single root field template.</p></div></div><div class="code"><div class="wrapper">  wrapFieldTemplates: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplates)</span> {</span>
    <span class="hljs-keyword">return</span> {
      type: <span class="hljs-string">'fields'</span>,
      plain: <span class="hljs-literal">true</span>,
      fields: fieldTemplates
    };
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Given the props that are passed in, create the root field.</p></div></div><div class="code"><div class="wrapper">  createRootField: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(props)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> fieldTemplate = props.fieldTemplate || props.fieldTemplates || props.field || props.fields;
    <span class="hljs-keyword">var</span> value = props.value;

    <span class="hljs-keyword">if</span> (!fieldTemplate) {
      fieldTemplate = config.createFieldTemplateFromValue(value);
    }

    <span class="hljs-keyword">if</span> (_.isArray(fieldTemplate)) {
      fieldTemplate = config.wrapFieldTemplates(fieldTemplate);
    }

    <span class="hljs-keyword">var</span> field = _.extend({}, fieldTemplate, {rawFieldTemplate: fieldTemplate});
    <span class="hljs-keyword">if</span> (config.hasValue(fieldTemplate, value)) {
      field.value = config.coerceValue(fieldTemplate, value);
    } <span class="hljs-keyword">else</span> {
      field.value = config.createDefaultValue(fieldTemplate);
    }

    config.initRootField(field, props);
    config.initField(field);

    <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">null</span> || config.isEmptyObject(value) || _.isUndefined(value)) {
      field.value = config.inflateFieldValue(field);
    }

    <span class="hljs-keyword">return</span> field;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Given the props that are passed in, create the value that will be displayed
by all the components.</p></div></div><div class="code"><div class="wrapper">  createRootValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(props)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> field = config.createRootField(props);

    <span class="hljs-keyword">return</span> config.inflateFieldValue(field);
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Create dynamic child fields for a field.</p></div></div><div class="code"><div class="wrapper">  createChildFields: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> typeName = config.fieldTypeName(field);

    <span class="hljs-keyword">if</span> (config[<span class="hljs-string">'createChildFields_'</span> + typeName]) {
      <span class="hljs-keyword">return</span> config[<span class="hljs-string">'createChildFields_'</span> + typeName](field);
    }

    <span class="hljs-keyword">return</span> config.fieldChildFieldTemplates(field).map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(childField, i)</span> {</span>
      <span class="hljs-keyword">return</span> config.createChildField(field, {
        fieldTemplate: childField, key: childField.key, fieldIndex: i, value: field.value[childField.key]
      });
    });
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Create a single child field for a parent field.</p></div></div><div class="code"><div class="wrapper">  createChildField: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(parentField, options)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> childValue = options.value;

    <span class="hljs-keyword">var</span> childField = _.extend({}, options.fieldTemplate, {
      key: options.key, parent: parentField, fieldIndex: options.fieldIndex,
      rawFieldTemplate: options.fieldTemplate
    });

    <span class="hljs-keyword">if</span> (config.hasValue(options.fieldTemplate, childValue)) {
      childField.value = config.coerceValue(options.fieldTemplate, childValue);
    } <span class="hljs-keyword">else</span> {
      childField.value = config.createDefaultValue(options.fieldTemplate);
    }

    config.initField(childField);

    <span class="hljs-keyword">return</span> childField;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Create a temporary field and extract its value.</p></div></div><div class="code"><div class="wrapper">  createNewChildFieldValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(parentField, itemFieldIndex)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> childFieldTemplate = config.fieldItemFieldTemplates(parentField)[itemFieldIndex];

    <span class="hljs-keyword">var</span> newValue = config.fieldTemplateValue(childFieldTemplate);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Just a placeholder key. Should not be important.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> key = <span class="hljs-string">'__unknown_key__'</span>;

    <span class="hljs-keyword">if</span> (_.isArray(parentField.value)) {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Just a placeholder position for an array.</p></div></div><div class="code"><div class="wrapper">      key = parentField.value.length;
    }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Just a placeholder field index. Should not be important.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> fieldIndex = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (_.isObject(parentField.value)) {
      fieldIndex = <span class="hljs-built_in">Object</span>.keys(parentField.value).length;
    }

    <span class="hljs-keyword">var</span> childField = config.createChildField(parentField, {
      fieldTemplate: childFieldTemplate, key: key, fieldIndex: fieldIndex, value: newValue
    });

    newValue = config.inflateFieldValue(childField);

    <span class="hljs-keyword">return</span> newValue;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Given a value, create a field template for that value.</p></div></div><div class="code"><div class="wrapper">  createFieldTemplateFromValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> field = {
      type: <span class="hljs-string">'json'</span>
    };
    <span class="hljs-keyword">if</span> (_.isString(value)) {
      field = {
        type: <span class="hljs-string">'string'</span>
      };
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isNumber(value)) {
      field = {
        type: <span class="hljs-string">'number'</span>
      };
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isBoolean(value)) {
      field = {
        type: <span class="hljs-string">'boolean'</span>
      };
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isArray(value)) {
      <span class="hljs-keyword">var</span> arrayItemFields = value.map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value, i)</span> {</span>
        <span class="hljs-keyword">var</span> childField = config.createFieldTemplateFromValue(value);
        childField.key = i;
        <span class="hljs-keyword">return</span> childField;
      });
      field = {
        type: <span class="hljs-string">'array'</span>,
        fields: arrayItemFields
      };
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isObject(value)) {
      <span class="hljs-keyword">var</span> objectItemFields = <span class="hljs-built_in">Object</span>.keys(value).map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>
        <span class="hljs-keyword">var</span> childField = config.createFieldTemplateFromValue(value[key]);
        childField.key = key;
        childField.label = config.humanize(key);
        <span class="hljs-keyword">return</span> childField;
      });
      field = {
        type: <span class="hljs-string">'object'</span>,
        fields: objectItemFields
      };
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isNull(value)) {
      field = {
        type: <span class="hljs-string">'json'</span>
      };
    }
    <span class="hljs-keyword">return</span> field;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Default value factory</p></div></div><div class="code"><div class="wrapper">  createDefaultValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> defaultValue = config.fieldTemplateDefaultValue(fieldTemplate);

    <span class="hljs-keyword">if</span> (!_.isUndefined(defaultValue)) {
      <span class="hljs-keyword">return</span> utils.deepCopy(defaultValue);
    }

    <span class="hljs-keyword">var</span> typeName = config.fieldTypeName(fieldTemplate);

    <span class="hljs-keyword">if</span> (config[<span class="hljs-string">'createDefaultValue_'</span> + typeName]) {
      <span class="hljs-keyword">return</span> config[<span class="hljs-string">'createDefaultValue_'</span> + typeName](fieldTemplate);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Field helpers</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Determine if a value &quot;exists&quot;.</p></div></div><div class="code"><div class="wrapper">  hasValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate, value)</span> {</span>
    <span class="hljs-keyword">return</span> value !== <span class="hljs-literal">null</span> &amp;&amp; !_.isUndefined(value);
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Coerce a value to value appropriate for a field.</p></div></div><div class="code"><div class="wrapper">  coerceValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field, value)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> typeName = config.fieldTypeName(field);

    <span class="hljs-keyword">if</span> (config[<span class="hljs-string">'coerceValue_'</span> + typeName]) {
      <span class="hljs-keyword">return</span> config[<span class="hljs-string">'coerceValue_'</span> + typeName](field, value);
    }

    <span class="hljs-keyword">return</span> value;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Given a field and a child value, find the appropriate field template for
that child value.</p></div></div><div class="code"><div class="wrapper">  childFieldTemplateForValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field, childValue)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> fieldTemplate;

    <span class="hljs-keyword">var</span> fieldTemplates = config.fieldItemFieldTemplates(field);

    fieldTemplate = _.find(fieldTemplates, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate)</span> {</span>
      <span class="hljs-keyword">return</span> config.matchesFieldTemplateToValue(fieldTemplate, childValue);
    });

    <span class="hljs-keyword">if</span> (fieldTemplate) {
      <span class="hljs-keyword">return</span> fieldTemplate;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> config.createFieldTemplateFromValue(childValue);
    }
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Determine if a value is a match for a field template.</p></div></div><div class="code"><div class="wrapper">  matchesFieldTemplateToValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate, value)</span> {</span>
    <span class="hljs-keyword">var</span> match = fieldTemplate.match;
    <span class="hljs-keyword">if</span> (!match) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> _.every(_.keys(match), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>
      <span class="hljs-keyword">return</span> _.isEqual(match[key], value[key]);
    });
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Field template helpers</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Normalized (PascalCase) type name for a field.</p></div></div><div class="code"><div class="wrapper">  fieldTemplateTypeName: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> typeName = utils.dashToPascal(fieldTemplate.type || <span class="hljs-string">'undefined'</span>);

    <span class="hljs-keyword">var</span> alias = config[<span class="hljs-string">'alias_'</span> + typeName];

    <span class="hljs-keyword">if</span> (alias) {
      <span class="hljs-keyword">if</span> (_.isFunction(alias)) {
        <span class="hljs-keyword">return</span> alias.call(config, fieldTemplate);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> alias;
      }
    }

    <span class="hljs-keyword">if</span> (fieldTemplate.list) {
      typeName = <span class="hljs-string">'Array'</span>;
    }

    <span class="hljs-keyword">return</span> typeName;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Default value for a field template.</p></div></div><div class="code"><div class="wrapper">  fieldTemplateDefaultValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate)</span> {</span>

    <span class="hljs-keyword">return</span> fieldTemplate.default;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Value for a field template. Used to determine the value of a new child
field.</p></div></div><div class="code"><div class="wrapper">  fieldTemplateValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This logic might be brittle.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> defaultValue = config.fieldTemplateDefaultValue(fieldTemplate);

    <span class="hljs-keyword">var</span> match = config.fieldTemplateMatch(fieldTemplate);

    <span class="hljs-keyword">var</span> value;

    <span class="hljs-keyword">if</span> (_.isUndefined(defaultValue) &amp;&amp; !_.isUndefined(match)) {
      <span class="hljs-keyword">return</span> utils.deepCopy(match);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> config.createDefaultValue(fieldTemplate);
    }

    <span class="hljs-keyword">return</span> value;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Match rule for a field template.</p></div></div><div class="code"><div class="wrapper">  fieldTemplateMatch: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate)</span> {</span>
    <span class="hljs-keyword">return</span> fieldTemplate.match;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Determine if a field template has a single-line value.</p></div></div><div class="code"><div class="wrapper">  fieldTemplateIsSingleLine: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fieldTemplate)</span> {</span>
    <span class="hljs-keyword">return</span> fieldTemplate.isSingleLine || fieldTemplate.is_single_line ||
            fieldTemplate.type === <span class="hljs-string">'single-line-string'</span> || fieldTemplate.type === <span class="hljs-string">'SingleLineString'</span>;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Field helpers</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get an array of keys representing the path to a value.</p></div></div><div class="code"><div class="wrapper">  fieldValuePath: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> parentPath = [];

    <span class="hljs-keyword">if</span> (field.parent) {
      parentPath = config.fieldValuePath(field.parent);
    }

    <span class="hljs-keyword">return</span> parentPath.concat(field.key).filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>
      <span class="hljs-keyword">return</span> !_.isUndefined(key) &amp;&amp; key !== <span class="hljs-string">''</span>;
    });
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Clone a field with a different value.</p></div></div><div class="code"><div class="wrapper">  fieldWithValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field, value)</span> {</span>
    <span class="hljs-keyword">return</span> _.extend({}, field, {value: value});
  },

  fieldTypeName: utils.delegateTo(<span class="hljs-string">'fieldTemplateTypeName'</span>),</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get the choices for a dropdown field.</p></div></div><div class="code"><div class="wrapper">  fieldChoices: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">return</span> config.normalizeChoices(field.choices);
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get a set of boolean choices for a field.</p></div></div><div class="code"><div class="wrapper">  fieldBooleanChoices: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> choices = config.fieldChoices(field);

    <span class="hljs-keyword">if</span> (choices.length === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> [{
        label: <span class="hljs-string">'Yes'</span>,
        value: <span class="hljs-literal">true</span>
      },{
        label: <span class="hljs-string">'No'</span>,
        value: <span class="hljs-literal">false</span>
      }];
    }

    <span class="hljs-keyword">return</span> choices.map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(choice)</span> {</span>
      <span class="hljs-keyword">if</span> (_.isBoolean(choice.value)) {
        <span class="hljs-keyword">return</span> choice;
      }
      <span class="hljs-keyword">return</span> _.extend({}, choice, {
        value: config.coerceValueToBoolean(choice.value)
      });
    });
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get a set of replacement choices for a field.</p></div></div><div class="code"><div class="wrapper">  fieldReplaceChoices: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">return</span> config.normalizeChoices(field.replaceChoices);
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get a label for a field.</p></div></div><div class="code"><div class="wrapper">  fieldLabel: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">return</span> field.label;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get the help text for a field.</p></div></div><div class="code"><div class="wrapper">  fieldHelpText: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">return</span> field.help_text_html || field.help_text || field.helpText || field.helpTextHtml;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get whether or not a field is required.</p></div></div><div class="code"><div class="wrapper">  fieldIsRequired: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">return</span> field.required ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Determine if value for this field is not a leaf value.</p></div></div><div class="code"><div class="wrapper">  fieldHasValueChildren: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> defaultValue = config.createDefaultValue(field);

    <span class="hljs-keyword">if</span> (_.isObject(defaultValue) || _.isArray(defaultValue)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get the child field templates for this field.</p></div></div><div class="code"><div class="wrapper">  fieldChildFieldTemplates: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">return</span> field.fields || [];
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get the field templates for each item of this field. (For dynamic children,
like arrays.)</p></div></div><div class="code"><div class="wrapper">  fieldItemFieldTemplates: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">if</span> (!field.itemFields) {
      <span class="hljs-keyword">return</span> [{type: <span class="hljs-string">'text'</span>}];
    }
    <span class="hljs-keyword">if</span> (!_.isArray(field.itemFields)) {
      <span class="hljs-keyword">return</span> [field.itemFields];
    }
    <span class="hljs-keyword">return</span> field.itemFields;
  },

  fieldIsSingleLine: utils.delegateTo(<span class="hljs-string">'fieldTemplateIsSingleLine'</span>),</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get whether or not a field is collapsed.</p></div></div><div class="code"><div class="wrapper">  fieldIsCollapsed: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">return</span> field.collapsed ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get wheter or not a field can be collapsed.</p></div></div><div class="code"><div class="wrapper">  fieldIsCollapsible: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">return</span> field.collapsible || !_.isUndefined(field.collapsed);
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get the number of rows for a field.</p></div></div><div class="code"><div class="wrapper">  fieldRows: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(field)</span> {</span>
    <span class="hljs-keyword">return</span> field.rows;
  },

  fieldMatch: utils.delegateTo(<span class="hljs-string">'fieldTemplateMatch'</span>),</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Other helpers</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Convert a key to a nice human-readable version.</p></div></div><div class="code"><div class="wrapper">  humanize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(property)</span> {</span>
    property = property.replace(<span class="hljs-regexp">/\{\{/g</span>, <span class="hljs-string">''</span>);
    property = property.replace(<span class="hljs-regexp">/\}\}/g</span>, <span class="hljs-string">''</span>);
    <span class="hljs-keyword">return</span> property.replace(<span class="hljs-regexp">/_/g</span>, <span class="hljs-string">' '</span>)
    .replace(<span class="hljs-regexp">/(\w+)/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(match)</span> {</span>
      <span class="hljs-keyword">return</span> match.charAt(<span class="hljs-number">0</span>).toUpperCase() + match.slice(<span class="hljs-number">1</span>);
    });
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Normalize some choices for a drop-down.</p></div></div><div class="code"><div class="wrapper">  normalizeChoices: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(choices)</span> {</span>
    <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">if</span> (!choices) {
      <span class="hljs-keyword">return</span> [];
    }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Convert comma separated string to array of strings.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> (_.isString(choices)) {
      choices = choices.split(<span class="hljs-string">','</span>);
    }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Convert object to array of objects with <code>value</code> and <code>label</code> properties.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> (!_.isArray(choices) &amp;&amp; _.isObject(choices)) {
      choices = <span class="hljs-built_in">Object</span>.keys(choices).map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>
        <span class="hljs-keyword">return</span> {
          value: key,
          label: choices[key]
        };
      });
    }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Copy the array of choices so we can manipulate them.</p></div></div><div class="code"><div class="wrapper">    choices = choices.slice(<span class="hljs-number">0</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Array of choice arrays should be flattened.</p></div></div><div class="code"><div class="wrapper">    choices = _.flatten(choices);

    choices.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(choice, i)</span> {</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Convert any string choices to objects with <code>value</code> and <code>label</code>
properties.</p></div></div><div class="code"><div class="wrapper">      <span class="hljs-keyword">if</span> (_.isString(choice)) {
        choices[i] = {
          value: choice,
          label: config.humanize(choice)
        };
      }
      <span class="hljs-keyword">if</span> (!choices[i].label) {
        choices[i].label = config.humanize(choices[i].value);
      }
    });

    <span class="hljs-keyword">return</span> choices;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Coerce a value to a boolean</p></div></div><div class="code"><div class="wrapper">  coerceValueToBoolean: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
    <span class="hljs-keyword">if</span> (!_.isString(value)) {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Just use the default truthiness.</p></div></div><div class="code"><div class="wrapper">      <span class="hljs-keyword">return</span> value ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
    }
    value = value.toLowerCase();
    <span class="hljs-keyword">if</span> (value === <span class="hljs-string">''</span> || value === <span class="hljs-string">'no'</span> || value === <span class="hljs-string">'off'</span> || value === <span class="hljs-string">'false'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Determine if a value is a valid key.</p></div></div><div class="code"><div class="wrapper">  isKey: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>
    <span class="hljs-keyword">return</span> (_.isNumber(key) &amp;&amp; key &gt;= <span class="hljs-number">0</span>) || (_.isString(key) &amp;&amp; key !== <span class="hljs-string">''</span>);
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Fast way to check for empty object.</p></div></div><div class="code"><div class="wrapper">  isEmptyObject: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj)</span> {</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> obj) {
      <span class="hljs-keyword">if</span> (obj.hasOwnProperty(key)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
};</div></div></div></div></body></html>