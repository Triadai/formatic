<!DOCTYPE html><html lang="en"><head><title>default/util</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="default/util"><meta name="groc-project-path" content="lib/default/util.js"><meta name="groc-github-url" content="https://github.com/zapier/formatic"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/zapier/formatic/blob/master/lib/default/util.js">lib/default/util.js</a></div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="util">util</h1></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Some utility functions to be used by other plugins.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-pi">
'use strict'</span>;

<span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>);

module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(plugin)</span> {</span>

  <span class="hljs-keyword">var</span> util = plugin.exports;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Check if a value is &quot;blank&quot;.</p></div></div><div class="code"><div class="wrapper">  util.isBlank = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
    <span class="hljs-keyword">return</span> value === <span class="hljs-literal">undefined</span> || value === <span class="hljs-literal">null</span> || value === <span class="hljs-string">''</span>;
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set value at some path in object.</p></div></div><div class="code"><div class="wrapper">  util.setIn = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj, path, value)</span> {</span>
    <span class="hljs-keyword">if</span> (_.isString(path)) {
      path = [path];
    }
    <span class="hljs-keyword">if</span> (path.length === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> value;
    }
    <span class="hljs-keyword">if</span> (path.length === <span class="hljs-number">1</span>) {
      obj[path[<span class="hljs-number">0</span>]] = value;
      <span class="hljs-keyword">return</span> obj;
    }
    <span class="hljs-keyword">if</span> (!obj[path[<span class="hljs-number">0</span>]]) {
      obj[path[<span class="hljs-number">0</span>]] = {};
    }
    util.setIn(obj[path[<span class="hljs-number">0</span>]], path.slice(<span class="hljs-number">1</span>), value);
    <span class="hljs-keyword">return</span> obj;
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Remove value at path in some object.</p></div></div><div class="code"><div class="wrapper">  util.removeIn = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj, path)</span> {</span>
    <span class="hljs-keyword">if</span> (_.isString(path)) {
      path = [path];
    }
    <span class="hljs-keyword">if</span> (path.length === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    <span class="hljs-keyword">if</span> (path.length === <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">if</span> (_.isArray(obj)) {
        <span class="hljs-keyword">if</span> (_.isNumber(path[<span class="hljs-number">0</span>])) {
          obj.splice(path[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>);
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isObject(obj)) {
        <span class="hljs-keyword">delete</span> obj[path[<span class="hljs-number">0</span>]];
      }
      <span class="hljs-keyword">return</span> obj;
    }
    <span class="hljs-keyword">if</span> (obj[path[<span class="hljs-number">0</span>]]) {
      util.removeIn(obj[path[<span class="hljs-number">0</span>]], path.slice(<span class="hljs-number">1</span>));
    }
    <span class="hljs-keyword">return</span> obj;
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get value at path in some object.</p></div></div><div class="code"><div class="wrapper">  util.getIn = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj, path)</span> {</span>
    <span class="hljs-keyword">if</span> (_.isString(path)) {
      path = [path];
    }
    <span class="hljs-keyword">if</span> (path.length === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> obj;
    }
    <span class="hljs-keyword">if</span> (obj[path[<span class="hljs-number">0</span>]]) {
      <span class="hljs-keyword">return</span> util.getIn(obj[path[<span class="hljs-number">0</span>]], path.slice(<span class="hljs-number">1</span>));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Append to array at path in some object.</p></div></div><div class="code"><div class="wrapper">  util.appendIn = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj, path, value)</span> {</span>
    <span class="hljs-keyword">var</span> subObj = util.getIn(obj, path);
    <span class="hljs-keyword">if</span> (_.isArray(subObj)) {
      subObj.push(value);
    }
    <span class="hljs-keyword">return</span> obj;
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Swap two keys at path in some object.</p></div></div><div class="code"><div class="wrapper">  util.moveIn = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj, path, fromKey, toKey)</span> {</span>
    <span class="hljs-keyword">var</span> subObj = util.getIn(obj, path);
    <span class="hljs-keyword">if</span> (_.isArray(subObj)) {
      <span class="hljs-keyword">if</span> (_.isNumber(fromKey) &amp;&amp; _.isNumber(toKey)) {
        <span class="hljs-keyword">var</span> fromIndex = fromKey;
        <span class="hljs-keyword">var</span> toIndex = toKey;
        <span class="hljs-keyword">if</span> (fromIndex !== toIndex &amp;&amp;
          fromIndex &gt;= <span class="hljs-number">0</span> &amp;&amp; fromIndex &lt; subObj.length &amp;&amp;
          toIndex &gt;= <span class="hljs-number">0</span> &amp;&amp; toIndex &lt; subObj.length
        ) {
          subObj.splice(toIndex, <span class="hljs-number">0</span>, subObj.splice(fromIndex, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]);
        }
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">var</span> fromValue = subObj[fromKey];
      subObj[fromKey] = subObj[toKey];
      subObj[toKey] = fromValue;
    }
    <span class="hljs-keyword">return</span> obj;
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Copy obj, leaving non-JSON behind.</p></div></div><div class="code"><div class="wrapper">  util.copyValue = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(value));
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Copy obj recursing deeply.</p></div></div><div class="code"><div class="wrapper">  util.deepCopy = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj)</span> {</span>
    <span class="hljs-keyword">if</span> (_.isArray(obj)) {
      <span class="hljs-keyword">return</span> obj.map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span>
        <span class="hljs-keyword">return</span> util.deepCopy(item);
      });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isObject(obj)) {
      <span class="hljs-keyword">var</span> copy = {};
      _.each(obj, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value, key)</span> {</span>
        copy[key] = util.deepCopy(value);
      });
      <span class="hljs-keyword">return</span> copy;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> obj;
    }
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Check if item matches some value, based on the item&#39;s <code>match</code> property.</p></div></div><div class="code"><div class="wrapper">  util.itemMatchesValue = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item, value)</span> {</span>
    <span class="hljs-keyword">var</span> match = item.match;
    <span class="hljs-keyword">if</span> (!match) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> _.every(_.keys(match), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>
      <span class="hljs-keyword">return</span> _.isEqual(match[key], value[key]);
    });
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Create a field definition from a value.</p></div></div><div class="code"><div class="wrapper">  util.fieldDefFromValue = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
    <span class="hljs-keyword">var</span> def = {
      type: <span class="hljs-string">'json'</span>
    };
    <span class="hljs-keyword">if</span> (_.isString(value)) {
      def = {
        type: <span class="hljs-string">'string'</span>
      };
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isArray(value)) {
      <span class="hljs-keyword">var</span> arrayItemFields = value.map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value, i)</span> {</span>
        <span class="hljs-keyword">var</span> childDef = util.fieldDefFromValue(value);
        childDef.key = i;
        <span class="hljs-keyword">return</span> childDef;
      });
      def = {
        type: <span class="hljs-string">'array'</span>,
        fields: arrayItemFields
      };
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isObject(value)) {
      <span class="hljs-keyword">var</span> objectItemFields = <span class="hljs-built_in">Object</span>.keys(value).map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>
        <span class="hljs-keyword">var</span> childDef = util.fieldDefFromValue(value[key]);
        childDef.key = key;
        childDef.label = util.humanize(key);
        <span class="hljs-keyword">return</span> childDef;
      });
      def = {
        type: <span class="hljs-string">'object'</span>,
        fields: objectItemFields
      };
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isNull(value)) {
      def = {
        type: <span class="hljs-string">'null'</span>
      };
    }
    <span class="hljs-keyword">return</span> def;
  };

  <span class="hljs-keyword">if</span> (plugin.config.humanize) {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get the humanize function from a plugin if provided.</p></div></div><div class="code"><div class="wrapper">    util.humanize = plugin.require(plugin.config.humanize);
  } <span class="hljs-keyword">else</span> {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Convert property keys to &quot;human&quot; labels. For example, &#39;foo&#39; becomes
&#39;Foo&#39;.</p></div></div><div class="code"><div class="wrapper">    util.humanize = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(property)</span> {</span>
      property = property.replace(<span class="hljs-regexp">/\{\{/g</span>, <span class="hljs-string">''</span>);
      property = property.replace(<span class="hljs-regexp">/\}\}/g</span>, <span class="hljs-string">''</span>);
      <span class="hljs-keyword">return</span> property.replace(<span class="hljs-regexp">/_/g</span>, <span class="hljs-string">' '</span>)
        .replace(<span class="hljs-regexp">/(\w+)/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(match)</span> {</span>
          <span class="hljs-keyword">return</span> match.charAt(<span class="hljs-number">0</span>).toUpperCase() + match.slice(<span class="hljs-number">1</span>);
        });
    };
  }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Join multiple CSS class names together, ignoring any that aren&#39;t there.</p></div></div><div class="code"><div class="wrapper">  util.className = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

    <span class="hljs-keyword">var</span> classNames = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">0</span>);

    classNames = classNames.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> {</span>
      <span class="hljs-keyword">return</span> name;
    });

    <span class="hljs-keyword">return</span> classNames.join(<span class="hljs-string">' '</span>);
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Join keys together to make single &quot;meta&quot; key. For looking up metadata in
the metadata part of the store.</p></div></div><div class="code"><div class="wrapper">  util.joinMetaKeys = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(keys)</span> {</span>
    <span class="hljs-keyword">return</span> keys.join(<span class="hljs-string">'::'</span>);
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Split a joined key into separate key parts.</p></div></div><div class="code"><div class="wrapper">  util.splitMetaKey = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>
    <span class="hljs-keyword">return</span> key.split(<span class="hljs-string">'::'</span>);
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Wrap a text value so it has a type. For parsing text with tags.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">var</span> textPart = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value, type)</span> {</span>
    type = type || <span class="hljs-string">'text'</span>;
    <span class="hljs-keyword">return</span> {
      type: type,
      value: value
    };
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Parse text that has tags like {{tag}} into text and tags.</p></div></div><div class="code"><div class="wrapper">  util.parseTextWithTags = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
    value = value || <span class="hljs-string">''</span>;
    <span class="hljs-keyword">var</span> parts = value.split(<span class="hljs-regexp">/{{(?!{)/</span>);
    <span class="hljs-keyword">var</span> frontPart = [];
    <span class="hljs-keyword">if</span> (parts[<span class="hljs-number">0</span>] !== <span class="hljs-string">''</span>) {
      frontPart = [
        textPart(parts[<span class="hljs-number">0</span>])
      ];
    }
    parts = frontPart.concat(
      parts.slice(<span class="hljs-number">1</span>).map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(part)</span> {</span>
        <span class="hljs-keyword">if</span> (part.indexOf(<span class="hljs-string">'}}'</span>) &gt;= <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">return</span> [
            textPart(part.substring(<span class="hljs-number">0</span>, part.indexOf(<span class="hljs-string">'}}'</span>)), <span class="hljs-string">'tag'</span>),
            textPart(part.substring(part.indexOf(<span class="hljs-string">'}}'</span>) + <span class="hljs-number">2</span>))
          ];
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> textPart(<span class="hljs-string">'{{'</span> + part, <span class="hljs-string">'text'</span>);
        }
      })
    );
    <span class="hljs-keyword">return</span> [].concat.apply([], parts);
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Copy all computed styles from one DOM element to another.</p></div></div><div class="code"><div class="wrapper">  util.copyElementStyle = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fromElement, toElement)</span> {</span>
    <span class="hljs-keyword">var</span> fromStyle = window.getComputedStyle(fromElement, <span class="hljs-string">''</span>);

    <span class="hljs-keyword">if</span> (fromStyle.cssText !== <span class="hljs-string">''</span>) {
      toElement.style.cssText = fromStyle.cssText;
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> cssRules = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; fromStyle.length; i++) {
      <span class="hljs-comment">//console.log(i, fromStyle[i], fromStyle.getPropertyValue(fromStyle[i]))</span>
      <span class="hljs-comment">//toElement.style[fromStyle[i]] = fromStyle.getPropertyValue(fromStyle[i]);</span>
      cssRules.push(fromStyle[i] + <span class="hljs-string">':'</span> + fromStyle.getPropertyValue(fromStyle[i]) + <span class="hljs-string">';'</span>);
    }
    <span class="hljs-keyword">var</span> cssText = cssRules.join(<span class="hljs-string">''</span>);

    toElement.style.cssText = cssText;
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Object to hold browser sniffing info.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">var</span> browser = {
    isChrome: <span class="hljs-literal">false</span>,
    isMozilla: <span class="hljs-literal">false</span>,
    isOpera: <span class="hljs-literal">false</span>,
    isIe: <span class="hljs-literal">false</span>,
    isSafari: <span class="hljs-literal">false</span>
  };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Sniff the browser.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">var</span> ua = navigator.userAgent;
  <span class="hljs-keyword">if</span>(ua.indexOf(<span class="hljs-string">'Chrome'</span>) &gt; -<span class="hljs-number">1</span>) {
    browser.isChrome = <span class="hljs-literal">true</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ua.indexOf(<span class="hljs-string">'Safari'</span>) &gt; -<span class="hljs-number">1</span>) {
    browser.isSafari = <span class="hljs-literal">true</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ua.indexOf(<span class="hljs-string">'Opera'</span>) &gt; -<span class="hljs-number">1</span>) {
    browser.isOpera = <span class="hljs-literal">true</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ua.indexOf(<span class="hljs-string">'Firefox'</span>) &gt; -<span class="hljs-number">1</span>) {
    browser.isMozilla = <span class="hljs-literal">true</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ua.indexOf(<span class="hljs-string">'MSIE'</span>) &gt; -<span class="hljs-number">1</span>) {
    browser.isIe = <span class="hljs-literal">true</span>;
  }

  util.browser = browser;

};</div></div></div></div></body></html>