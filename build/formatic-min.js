!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.Formatic=e()}}(function(){return function e(n,t,i){function o(r,a){if(!t[r]){if(!n[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(s)return s(r,!0);var f=new Error("Cannot find module '"+r+"'");throw f.code="MODULE_NOT_FOUND",f}var u=t[r]={exports:{}};n[r][0].call(u.exports,function(e){var t=n[r][1][e];return o(t?t:e)},u,u.exports,e,n,t,i)}return t[r].exports}for(var s="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null;n.exports=function(e){var n=e.require("util"),i=function(e){return t.isString(e)&&(e=e.split(",")),!t.isArray(e)&&t.isObject(e)&&(e=Object.keys(e).map(function(n){return{value:n,label:e[n]}})),e=e.slice(0),e=t.flatten(e),e.forEach(function(i,o){t.isString(i)&&(e[o]={value:i,label:n.humanize(i)}),e[o].label||(e[o].label=n.humanize(e[o].value))}),e};e.exports.compile=function(e){""===e.choices?e.choices=[]:e.choices&&(e.choices=i(e.choices)),""===e.replaceChoices?e.replaceChoices=[]:e.replaceChoices&&(e.replaceChoices=i(e.replaceChoices),e.replaceChoicesLabels={},e.replaceChoices.forEach(function(n){e.replaceChoicesLabels[n.value]=n.label}))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,n){"use strict";n.exports=function(e){var n=function(e,n,t){var i=e[n];if(i){e[t]||(e[t]=[]),e.eval||(e.eval={}),e.eval.needsMeta||(e.eval.needsMeta=[]);var o,s,r=i.keys||[],a={};if(i.group){r.forEach(function(e){a[e]=["@get","item",e]}),o=[i.source].concat(a),s=["@getMeta"].concat(o);var l=["@forEach","item",["@getGroupValues",i.group]];e.eval.needsMeta.push(l.concat([o,["@not",s]])),e.eval[t]=l.concat([s,s])}else r.forEach(function(e){a[e]=["@get",e]}),o=[i.source].concat(a),s=["@getMeta"].concat(o),e.eval.needsMeta.push(["@if",s,null,o]),e.eval[t]=s;delete e[n]}};e.exports.compile=function(e){n(e,"lookup","choices"),n(e,"lookupReplacements","replaceChoices")}}},{}],3:[function(e,n){"use strict";n.exports=function(e){var n={help_text:"helpText"};e.exports.compile=function(e){Object.keys(n).forEach(function(t){var i=n[t];"undefined"==typeof e[i]&&"undefined"!=typeof e[t]&&(e[i]=e[t])})}}},{}],4:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null;n.exports=function(e){var n={unicode:function(e){e.type="string",e.maxRows=1},text:"string",select:function(e){e.choices=e.choices||[]},bool:"boolean",dict:"object",decimal:"number"};n.str=n.unicode,e.exports.compile=function(e){var i=n[e.type];i&&(t.isString(i)?e.type=i:t.isFunction(i)&&(e=i(e)))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,getDefaultProps:function(){return{className:e.config.className,label:e.configValue("label","[add]")}},render:function(){return i.span({className:this.props.className,onClick:this.props.onClick},this.props.label)}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM,o="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null;n.exports=function(e){e.exports=t.createClass({displayName:e.name,mixins:[e.require("mixin.field")],getDefaultProps:function(){return{className:e.config.className}},onChange:function(){var e=this.refs.choices.getDOMNode().getElementsByTagName("input");e=Array.prototype.slice.call(e,0);var n=e.map(function(e){return e.checked?e.value:null}).filter(function(e){return e});this.props.field.val(n)},render:function(){var n=this.props.field,t=n.def.choices||[],s=!o.find(t,function(e){return e.sample}),r=n.value||[];return e.component("field")({field:n},i.div({className:this.props.className,ref:"choices"},t.map(function(t,o){var a=i.span({style:{whiteSpace:"nowrap"}},i.input({name:n.def.key,type:"checkbox",value:t.value,checked:r.indexOf(t.value)>=0?!0:!1,onChange:this.onChange})," ",i.span({className:"field-choice-label"},t.label));return s?i.span({key:o,className:"field-choice"},a," "):i.div({key:o,className:"field-choice"},a," ",e.component("sample")({field:n,choice:t}))}.bind(this))))}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM,o="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null,s=t.createFactory(t.addons.CSSTransitionGroup);n.exports=function(e){e.exports=t.createClass({displayName:e.name,getDefaultProps:function(){return{className:e.config.className}},getInitialState:function(){return{collapsed:this.props.field.def.collapsed?!0:!1}},isCollapsible:function(){var e=this.props.field;return!o.isUndefined(e.def.collapsed)||!o.isUndefined(e.def.collapsible)},onClickLabel:function(){this.setState({collapsed:!this.state.collapsed})},render:function(){var n=this.props.field,t=this.props.index;return o.isNumber(t)||(t=o.isNumber(n.def.key)?n.def.key:void 0),i.div({className:this.props.className,style:{display:n.hidden()?"none":""}},e.component("label")({field:n,index:t,onClick:this.isCollapsible()?this.onClickLabel:null}),s({transitionName:"reveal"},this.state.collapsed?[]:[e.component("help")({key:"help",field:n}),this.props.children]))}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,mixins:[e.require("mixin.field")],getDefaultProps:function(){return{className:e.config.className}},render:function(){var n=this.props.field;return e.component("field")({field:n},i.fieldset({className:this.props.className},n.fields().map(function(e,n){return e.component({key:e.def.key||n})}.bind(this))))}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,getInitialState:function(){return{field:this.props.form.field()}},componentDidMount:function(){var e=this.props.form;e.on("change",this.onFormChanged)},componentWillUnmount:function(){var e=this.props.form;e.off("change",this.onFormChanged)},onFormChanged:function(){this.props.onChange&&this.props.onChange(this.props.form.val()),this.setState({field:this.props.form.field()})},render:function(){return i.div({className:"formatic"},this.state.field.component())}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],10:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,getDefaultProps:function(){return{className:e.config.className}},render:function(){var e=this.props.field;return e.def.helpText?i.div({className:this.props.className},e.def.helpText):i.span(null)}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,getDefaultProps:function(){return{className:e.config.className}},onChange:function(e){this.props.onSelect(parseInt(e.target.value))},render:function(){var e=this.props.field,n=null;return e.items().length>0&&(n=i.select({className:this.props.className,value:this.value,onChange:this.onChange},e.items().map(function(e,n){return i.option({key:n,value:n},e.label||n)}))),n?n:i.span(null)}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],12:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,mixins:[e.require("mixin.field")],getDefaultProps:function(){return{className:e.config.className,rows:e.config.rows||5}},isValidValue:function(e){try{return JSON.parse(e),!0}catch(n){return!1}},getInitialState:function(){return{isValid:!0,value:JSON.stringify(this.props.field.value)}},onChange:function(e){var n=this.isValidValue(e.target.value);n&&(this._isChanging=!0,this.props.field.val(JSON.parse(e.target.value))),this.setState({isValid:n,value:e.target.value})},componentWillReceiveProps:function(e){this._isChanging||this.setState({isValid:!0,value:JSON.stringify(e.field.value,null,2)}),this._isChanging=!1},render:function(){var n=this.props.field;return e.component("field")({field:n},i.textarea({className:this.props.className,value:this.state.value,onChange:this.onChange,style:{backgroundColor:this.state.isValid?"":"rgb(255,200,200)"},rows:n.def.rows||this.props.rows}))}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,getDefaultProps:function(){return{className:e.config.className}},render:function(){var e=this.props.field,n=null;if("number"==typeof this.props.index&&(n=""+(this.props.index+1)+".",e.def.label&&(n=n+" "+e.def.label)),e.def.label||n){var t=n||e.def.label;this.props.onClick&&(t=i.a({href:"JavaScript:",onClick:this.props.onClick},t)),n=i.label({},t)}var o=i.span({className:"required-text"});return i.div({className:this.props.className},n," ",o)}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,getDefaultProps:function(){return{className:e.config.className}},getInitialState:function(){return{itemIndex:0}},onSelect:function(e){this.setState({itemIndex:e})},onAppend:function(){this.props.onAppend(this.state.itemIndex)},render:function(){var n=this.props.field,t=null;return n.items().length>0&&(t=e.component("item-choices")({field:n,value:this.state.itemIndex,onSelect:this.onSelect})),i.div({className:this.props.className},t," ",e.component("add-item")({onClick:this.onAppend}))}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],15:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,getDefaultProps:function(){return{className:e.config.className}},onMoveBack:function(){this.props.onMove(this.props.index,this.props.index-1)},onMoveForward:function(){this.props.onMove(this.props.index,this.props.index+1)},onRemove:function(){this.props.onRemove(this.props.index)},render:function(){var n=this.props.field;return i.div({className:this.props.className},e.component("remove-item")({field:n,onClick:this.onRemove}),this.props.index>0?e.component("move-item-back")({onClick:this.onMoveBack}):null,this.props.index<this.props.numItems-1?e.component("move-item-forward")({onClick:this.onMoveForward}):null)}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],16:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,getDefaultProps:function(){return{className:e.config.className}},render:function(){var e=this.props.field;return i.div({className:this.props.className},e.component())}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],17:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,getDefaultProps:function(){return{className:e.config.className}},render:function(){var n=this.props.field;return i.div({className:this.props.className},e.component("list-item-value")({form:this.props.form,field:n,index:this.props.index}),e.component("list-item-control")({field:n,index:this.props.index,numItems:this.props.numItems,onMove:this.props.onMove,onRemove:this.props.onRemove}))}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],18:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM,o=t.createFactory(t.addons.CSSTransitionGroup);n.exports=function(e){e.exports=t.createClass({displayName:e.name,mixins:[e.require("mixin.field")],getDefaultProps:function(){return{className:e.config.className}},nextLookupId:0,getInitialState:function(){var e=[];return this.props.field.fields().forEach(function(n,t){e[t]="_"+this.nextLookupId,this.nextLookupId++}.bind(this)),{lookups:e}},componentWillReceiveProps:function(e){var n=this.state.lookups,t=e.field.fields();if(t.length>n.length)for(var i=n.length;i<t.length;i++)n[i]="_"+this.nextLookupId,this.nextLookupId++;this.setState({lookups:n})},onAppend:function(e){this.props.field.append(e)},onRemove:function(e){var n=this.state.lookups;n.splice(e,1),this.setState({lookups:n}),this.props.field.remove(e)},onMove:function(e,n){var t=this.state.lookups,i=t[e],o=t[n];t[e]=o,t[n]=i,this.setState({lookups:t}),this.props.field.move(e,n)},render:function(){var n=this.props.field,t=n.fields(),s=t.length;return e.component("field")({field:n},i.div({className:this.props.className},o({transitionName:"reveal"},t.map(function(t,i){return e.component("list-item")({key:this.state.lookups[i],form:this.props.form,field:t,parent:n,index:i,numItems:s,onMove:this.onMove,onRemove:this.onRemove})}.bind(this))),e.component("list-control")({field:n,onAppend:this.onAppend})))}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,getDefaultProps:function(){return{className:e.config.className,label:e.configValue("label","[up]")}},render:function(){return i.span({className:this.props.className,onClick:this.props.onClick},this.props.label)}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,getDefaultProps:function(){return{className:e.config.className,label:e.configValue("label","[down]")}},render:function(){return i.span({className:this.props.className,onClick:this.props.onClick},this.props.label)}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],21:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM,o="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null,s=function(e){return e.replace(/ /g," ")},r="  ",a="  ";n.exports=function(e){var n=e.require("util");e.exports=t.createClass({displayName:e.name,mixins:[e.require("mixin.field"),e.require("mixin.undo-stack"),e.require("mixin.resize")],getDefaultProps:function(){return{className:e.config.className}},getInitialState:function(){return{undoDepth:100}},componentWillMount:function(){this.tracking={};var e=n.parseTextWithTags(this.props.field.value),t=this.tokens(e),i=this.indexMap(t);this.tracking.pos=i.length,this.tracking.range=0,this.tracking.tokens=t,this.tracking.indexMap=i},getStateSnapshot:function(){return{value:this.props.field.value,pos:this.tracking.pos,range:this.tracking.range}},setStateSnapshot:function(e){this.tracking.pos=e.pos,this.tracking.range=e.range,this.props.field.val(e.value)},tokens:function(e){return[].concat.apply([],e.map(function(e){return"tag"===e.type?e:e.value.split("")}))},indexMap:function(e){var n=[];return o.each(e,function(e,t){if("tag"===e.type){var i=r+s(this.prettyLabel(e.value))+a,l=i.split("");o.each(l,function(){n.push(t)})}else n.push(t)}.bind(this)),n},onScroll:function(){this.refs.highlight.getDOMNode().scrollTop=this.refs.content.getDOMNode().scrollTop,this.refs.highlight.getDOMNode().scrollLeft=this.refs.content.getDOMNode().scrollLeft},tokenIndex:function(e,n,t){if(0>e)e=0;else if(e>=t.length)return n.length;return t[e]},onChange:function(e){var n=e.target,t=this.tracking.pos,i=this.tracking.range,o=n.selectionStart,s=this.tracking.tokens,r=this.tokenIndex(t,s,this.tracking.indexMap),a=this.tokenIndex(t+i,s,this.tracking.indexMap),l=a-r;if(l>0&&(s.splice(r,l),this.tracking.indexMap=this.indexMap(s)),o>t){var f=n.value.substring(t,o);s.splice(r,0,f)}if(t>o){var u=this.tokenAt(o),c=this.tokenBefore(o);u===c&&(o=this.moveOffTag(o,s,this.indexMap(s),-1));var d=this.tokenIndex(o,s,this.tracking.indexMap);s.splice(d,r-d)}var p=this.rawValue(s);this.tracking.pos=o,this.tracking.range=0,this.props.field.val(p),this.snapshot()},componentDidUpdate:function(){var e=this.props.field.value||"",t=n.parseTextWithTags(e);this.tracking.tokens=this.tokens(t),this.tracking.indexMap=this.indexMap(this.tracking.tokens);var i=this.normalizePosition(this.tracking.pos),o=this.tracking.range,s=this.normalizePosition(i+o);o=s-i,this.tracking.pos=i,this.tracking.range=o,document.activeElement===this.refs.content.getDOMNode()&&this.refs.content.getDOMNode().setSelectionRange(i,i+o)},prettyLabel:function(e){return this.props.field.def.replaceChoicesLabels[e]?this.props.field.def.replaceChoicesLabels[e]:n.humanize(e)},plainValue:function(e){var t=n.parseTextWithTags(e);return t.map(function(e){return"text"===e.type?e.value:r+s(this.prettyLabel(e.value))+a}.bind(this)).join("")},prettyValue:function(e){var t=n.parseTextWithTags(e);return t.map(function(e,n){return"text"===e.type?n===t.length-1&&"\n"===e.value[e.value.length-1]?e.value+" ":e.value:i.span({key:n,className:"pretty-part"},i.span({className:"pretty-part-left"},r),i.span({className:"pretty-part-text"},s(this.prettyLabel(e.value))),i.span({className:"pretty-part-right"},a))}.bind(this))},rawValue:function(e){return e.map(function(e){return"tag"===e.type?"{{"+e.value+"}}":e}).join("")},moveOffTag:function(e,n,t,i){i="undefined"==typeof i||i>0?1:-1;var o;if(i>0)for(o=n[t[e]];e<t.length&&"tag"===n[t[e]].type&&n[t[e]]===o;)e++;else for(o=n[t[e-1]];e>0&&"tag"===n[t[e-1]].type&&n[t[e-1]]===o;)e--;return e},tokenAt:function(e){return e>=this.tracking.indexMap.length?null:(0>e&&(e=0),this.tracking.tokens[this.tracking.indexMap[e]])},tokenBefore:function(e){return e>=this.tracking.indexMap.length&&(e=this.tracking.indexMap.length),0>=e?null:this.tracking.tokens[this.tracking.indexMap[e-1]]},normalizePosition:function(e,n){if(o.isUndefined(n)&&(n=e),0>=e||e>=this.tracking.indexMap.length)return 0>e&&(e=0),e>this.tracking.indexMap.length&&(e=this.tracking.indexMap.length),e;var t=this.tokenAt(e),i=this.tokenBefore(e);if(t!==i)return e;var s=this.tokenAt(n),r=this.tokenBefore(n),a=this.moveOffTag(e,this.tracking.tokens,this.tracking.indexMap),l=this.moveOffTag(e,this.tracking.tokens,this.tracking.indexMap,-1);if(s!==r){if(s===t)return a;if(r===t)return l}var f=a;return(e===n||n>e)&&a-e>e-l&&(f=l),f},onSelect:function(e){var n=e.target,t=n.selectionStart,i=n.selectionEnd;t=this.normalizePosition(t,this.tracking.pos),i=this.normalizePosition(i,this.tracking.pos+this.tracking.range),this.tracking.pos=t,this.tracking.range=i-t,n.selectionStart=t,n.selectionEnd=i},onCopy:function(){var e=this.refs.content.getDOMNode(),n=e.selectionStart,t=e.selectionEnd,i=e.value.substring(n,t),o=this.tokenIndex(n,this.tracking.tokens,this.tracking.indexMap),s=this.tokenIndex(t,this.tracking.tokens,this.tracking.indexMap),r=this.tracking.tokens.slice(o,s);i=this.rawValue(r);var a=e.value;e.value=e.value+i,e.setSelectionRange(a.length,a.length+i.length),window.setTimeout(function(){e.value=a,e.setSelectionRange(n,t)},0)},onKeyDown:function(e){90!==e.keyCode||!e.metaKey&&!e.ctrlKey||e.shiftKey?(89===e.keyCode&&e.ctrlKey&&!e.shiftKey||90===e.keyCode&&e.metaKey&&e.shiftKey)&&this.redo():(e.preventDefault(),this.undo())},adjustStyles:function(e){var t=this.refs.highlight.getDOMNode(),i=this.refs.content.getDOMNode(),o=window.getComputedStyle(i),s=o.backgroundColor;if(n.copyElementStyle(i,t),t.style.position="absolute",t.style.whiteSpace="pre-wrap",t.style.color="rgba(0,0,0,0)",t.style.webkitTextFillColor="rgba(0,0,0,0)",t.style.resize="none",t.style.borderColor="rgba(0,0,0,0)",n.browser.isMozilla){var r=parseFloat(o.paddingTop),a=parseFloat(o.paddingBottom),l=parseFloat(o.borderTopWidth),f=parseFloat(o.borderBottomWidth);t.style.paddingTop="0px",t.style.paddingBottom="0px",t.style.height=i.clientHeight-r-a+l+f+"px",t.style.top=o.paddingTop,t.style.boxShadow="none"}e&&(this.backgroundColor=s),t.style.backgroundColor=this.backgroundColor,i.style.backgroundColor="rgba(0,0,0,0)"},onResize:function(){this.adjustStyles()},onResizeWindow:function(){this.adjustStyles()},componentDidMount:function(){this.adjustStyles(!0),this.setOnResize("content",this.onResize)},onInsert:function(e){if(e.target.selectedIndex>0){var n=e.target.value;e.target.selectedIndex=0;var t=this.tracking.pos,i=this.normalizePosition(t),o=this.tracking.tokens,s=this.tokenIndex(i,o,this.tracking.indexMap);o.splice(s,0,{type:"tag",value:n}),this.tracking.indexMap=this.indexMap(o);var r=this.rawValue(o);this.tracking.pos+=this.prettyLabel(n).length,this.props.field.val(r)}},render:function(){var t=this.props.field,s=[{value:"",label:"Insert..."}].concat(t.def.replaceChoices);return e.component("field")({field:t},i.div({style:{position:"relative"}},i.pre({className:"pretty-highlight",ref:"highlight"},this.prettyValue(t.value)),i.textarea(o.extend({className:n.className(this.props.className,"pretty-content"),ref:"content",rows:t.def.rows||this.props.rows,name:t.key,value:this.plainValue(t.value),onChange:this.onChange,onScroll:this.onScroll,style:{position:"relative",top:0,left:0},onKeyPress:this.onKeyPress,onKeyDown:this.onKeyDown,onSelect:this.onSelect,onCopy:this.onCopy},e.config.attributes)),i.select({onChange:this.onInsert},s.map(function(e,n){return i.option({key:n,value:e.value},e.label)}))))}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],22:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,getDefaultProps:function(){return{className:e.config.className,label:e.configValue("label","[remove]")}},render:function(){return i.span({className:this.props.className,onClick:this.props.onClick},this.props.label)}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],23:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){var n=e.require("util");e.exports=t.createClass({displayName:e.name,getDefaultProps:function(){return{className:n.className("root",e.config.className)}},render:function(){var e=this.props.field;return i.div({className:this.props.className},e.fields().map(function(e,n){return e.component({key:e.def.key||n})}))}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],24:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,getDefaultProps:function(){return{className:e.config.className}},render:function(){var e=this.props.choice;return e.sample?i.div({className:this.props.className},e.sample):i.span(null)}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],25:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM,o="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null;n.exports=function(e){e.exports=t.createClass({displayName:e.name,mixins:[e.require("mixin.field")],getDefaultProps:function(){return{className:e.config.className}},onChange:function(e){var n=e.target.value,t=n.substring(0,n.indexOf(":"));if("choice"===t){var i=n.substring(n.indexOf(":")+1);i=parseInt(i),this.props.field.val(this.props.field.def.choices[i].value)}},render:function(){var n=this.props.field,t=n.def.choices||[],s=void 0!==n.value?n.value:"";t=t.map(function(e,n){return{choiceValue:"choice:"+n,value:e.value,label:e.label}});var r=o.find(t,function(e){return e.value===s});if(void 0===r){var a=s;o.isString(s)||(a=JSON.stringify(s)),r={choiceValue:"value:",value:s,label:a},t=[r].concat(t)}return e.component("field")({field:n},i.select({className:this.props.className,onChange:this.onChange,value:r.choiceValue},t.map(function(e,n){return i.option({key:n,value:e.choiceValue},e.label)}.bind(this))))}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],26:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,mixins:[e.require("mixin.field")],getDefaultProps:function(){return{className:e.config.className}},onChange:function(e){var n=e.target.value;this.props.field.val(n)},render:function(){var n=this.props.field;return e.component("field")({field:n},i.input({className:this.props.className,type:"text",value:n.value,rows:n.def.rows,onChange:this.onChange}))}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],27:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,i=t.DOM;n.exports=function(e){e.exports=t.createClass({displayName:e.name,mixins:[e.require("mixin.field")],getDefaultProps:function(){return{className:e.config.className,rows:e.config.rows||5}},onChange:function(e){var n=e.target.value;this.props.field.val(n)},render:function(){var n=this.props.field;return e.component("field")({field:n},i.textarea({className:this.props.className,value:n.value,rows:n.def.rows||this.props.rows,onChange:this.onChange}))}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],28:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null;n.exports=function(e){var n=e.require("field-router"),i=e.require("util"),o=e.require("eval"),s=e.require("compiler"),r=function(e,n,t,i){var o=this;o.form=e,o.def=n,o.value=t,o.parent=i,o.groups={},o.tempChildren=[]};e.exports.field=function(){var e=this;return new r(e,{type:"root"},e.store.value)};var a=r.prototype;a.typePlugin=function(){var n=this;return n._typePlugin||(n._typePlugin=e.require("type."+n.def.type)),n._typePlugin},a.component=function(e){var i=this;e=t.extend({},e,{field:i});var o=n.componentForField(i);return o(e)},a.fields=function(){var e=this;if(!e._fields){var n;n=e.typePlugin().fields?e.typePlugin().fields(e):e.def.fields?e.def.fields.map(function(n){return e.createChild(n)}):[],e._fields=n}return e._fields},a.items=function(){var e=this;return e._items||(e._items=t.isArray(e.def.items)?e.def.items.map(function(n){return e.resolve(n)}):[]),e._items},a.resolve=function(e){var n=this;if(t.isString(e)&&(e=n.form.findDef(e),!e))throw new Error("Could not find field: "+e);return e},a.evalDef=function(e){var n=this;if(e.eval)try{var i=n.eval(e.eval);i&&(e=t.extend({},e,i),e=s.compileDef(e),e.fields&&(e.fields=e.fields.map(function(e){return e=s.expandDef(e,n.form.store.templateMap),s.compileDef(e)})))}catch(o){console.log("Problem in eval: ",JSON.stringify(e.eval)),console.log(o.message),console.log(o.stack)}return e},a.eval=function(e,n){return o.evaluate(e,this,n)},a.createChild=function(e){var n=this;e=n.resolve(e);var o=n.value;e=n.evalDef(e),o=i.isBlank(e.key)?e.value:o&&!t.isUndefined(o[e.key])?o[e.key]:void 0;var s=new r(n.form,e,o,n);return n.tempChildren.push(s),s},a.itemForValue=function(e){var n=this,o=t.find(n.items(),function(n){return i.itemMatchesValue(n,e)});return o=o?t.extend({},o):i.fieldDefFromValue(e)},a.groupFields=function(e,n){var t=this;if(!t.groups[e]&&(t.groups[e]=[],t.parent)){var i=t.parent.fields();i.forEach(function(n){n!==t&&n.def.group===e&&t.groups[e].push(n)});var o=t.parent.groupFields(e,!0);t.groups[e]=t.groups[e].concat(o)}if(!n&&0===t.groups[e].length){var s=[];return t.tempChildren.forEach(function(n){n.def.group===e&&s.push(n)}),s}return t.groups[e]},a.valuePath=function(e){var n=this,t=e||[];return i.isBlank(n.def.key)||(t=[n.def.key].concat(t)),n.parent?n.parent.valuePath(t):t},a.val=function(e){var n=this;n.form.actions.setValue(n.valuePath(),e)},a.remove=function(e){var n=this,t=n.valuePath().concat(e);n.form.actions.removeValue(t)},a.move=function(e,n){var t=this;t.form.actions.moveValue(t.valuePath(),e,n)},a.default=function(){var e=this;return t.isUndefined(e.def.value)?t.isUndefined(e.def.default)?t.isUndefined(e.typePlugin().default)?null:i.copyValue(e.typePlugin().default):i.copyValue(e.def.default):i.copyValue(e.def.value)},a.append=function(e){var n=this,o=n.items()[e];o=t.extend(o),o.key=n.value.length;var s=n.createChild(o),r=s.default();if(t.isArray(r)||t.isObject(r)){var a=n.valuePath().length+1;s.inflate(function(e,n){r=i.setIn(r,e.slice(a),n)})}n.form.actions.appendValue(n.valuePath(),r)},a.hidden=function(){var e=this;return e.def.hidden||e.typePlugin().hidden},a.inflate=function(e){var n=this;!i.isBlank(n.def.key)&&t.isUndefined(n.value)&&e(n.valuePath(),n.default());var o=n.fields();o.forEach(function(n){n.inflate(e)})},a.erase=function(){var e=this;i.isBlank(e.def.key)||t.isUndefined(e.value)||e.form.actions.eraseValue(e.valuePath(),{})}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],29:[function(e,n){"use strict";n.exports=function(e){var n=e.requireAll(e.config.init),t=e.exports;t.init=function(){var e=this;n.forEach(function(n){n.apply(e,arguments)})}}},{}],30:[function(e,n){(function(t){"use strict";var i="undefined"!=typeof window?window._:"undefined"!=typeof t?t._:null,o=e("eventemitter3");
n.exports=function(e){var n=e.exports,t=e.require(e.config.store),s=e.require("util"),r=e.require("loader"),a=function(e,n){var t={};return n.forEach(function(n){t[n]=function(){e[n].apply(e,arguments)}}),t};n.init=function(e){var n=this;e=e||{};var i=new o;n.store=t(n,i,e),n.actions=a(n.store,["setValue","setFields","removeValue","appendValue","moveValue","eraseValue","setMeta"]),n.store.inflate(),n.on=i.on.bind(i),n.off=i.off.bind(i),n.once=i.once.bind(i)},n.component=function(n){var t=this;n=i.extend({},n,{form:t});var o=e.component("formatic");return o(n)},n.val=function(e){var n=this;return i.isUndefined(e)?s.copyValue(n.store.value):n.actions.setValue(e)},n.fields=function(e){var n=this;n.actions.setFields(e)},n.findDef=function(e){var n=this;return n.store.templateMap[e]||null},n.meta=function(e,n){var t=this;return i.isUndefined(n)?t.store.meta[e]:t.actions.setMeta(e,n)},n.loadMeta=function(e,n){n=n||{};var t=Object.keys(n),i=t.filter(function(e){return n[e]});i.length<t.length||r.loadMeta(this,e,n)},n.source=r.source}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{eventemitter3:57}],31:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null;n.exports=function(e){var n=e.exports,i=e.require("field-router");n.route=i.route,n.render=function(e,n){t.renderComponent(e,n)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],32:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null;n.exports=function(e){var n=e.requireAll(e.config.compilers),i=e.require("util"),o=e.exports;o.templateMap=function(e){var n={};return e.forEach(function(e){e.key&&(n[e.key]=e),e.id&&(n[e.id]=e)}),n},o.expandDef=function(e,n){var i=e.template,s=e.extends;if(t.isString(s)&&(s=[s]),s){var r=s.map(function(e){var t=n[e];if(!t)throw new Error("Template "+e+" not found.");return t}),a=[{}].concat(r.reverse().concat([e]));e=t.extend.apply(t,a)}return e.fields&&(e.fields=e.fields.map(function(e){return t.isString(e)?e:o.expandDef(e,n)})),e.items&&(e.items=e.items.map(function(e){return t.isString(e)?e:o.expandDef(e,n)})),!i&&e.template&&delete e.template,e},o.expandFields=function(e){var n=o.templateMap(e);return e.map(function(e){return o.expandDef(e,n)})},o.compileDef=function(t){t=i.deepCopy(t);var o;n.forEach(function(e){o=e.compile(t),o&&(t=o)});var s=e.require("type."+t.type);return s.compile&&(o=s.compile(t),o&&(t=o)),t},o.compileFields=function(e){return e.map(function(e){return o.compileDef(e)})}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],33:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null;n.exports=function(e){var n={},i=function(e,t){n[e]||(n[e]=[]),n[e].push(t)},o=e.requireAll(e.config.props);o.forEach(function(e){i.apply(null,e)});var s={};e.exports.component=function(i){if(!s[i]){var o=t.createFactory(e.require("component."+i));s[i]=function(e,t){return n[i]&&n[i].forEach(function(n){var t=n(e);t&&(e=t)}),o(e,t)}}return s[i]}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],34:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null;n.exports=function(e){e.exports=function(n){var i=e.requireAll(e.config.formatic),o=e.requireAll(e.config.form);i.forEach(function(e){t.keys(e).forEach(function(i){if(!t.isUndefined(n[i]))throw new Error("Property already defined for formatic: "+i);n[i]=e[i]})});var s=function(e){this.init&&this.init(e)};n.form=function(e){return new s(e)},s.prototype=n.form;var r=[];o.forEach(function(e){t.keys(e).forEach(function(n){if("init"===n)r.push(e[n]);else{if(!t.isUndefined(s.prototype[n]))throw new Error("Property already defined for form: "+n);s.prototype[n]=e[n]}})}),s.prototype.init=0===r.length?function(){}:1===r.length?r[0]:function(){var e=this,n=arguments;r.forEach(function(t){t.apply(e,n)})}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null,i=function(e){return function(n){n.exports=function(n,t,i){n=t.eval(n,i);var o=e.apply(null,n);return o}}},o=function(e){return function(n){n.exports=function(n,t,i){return n=t.eval(n,i),n.length>0?n[0][e].apply(n[0],n.slice(1)):void 0}}},s={"if":function(e){e.exports=function(e,n,t){return n.eval(e[0],t)?n.eval(e[1],t):n.eval(e[2],t)}},eq:function(e){e.exports=function(e,n,t){return n.eval(e[0],t)===n.eval(e[1],t)}},not:function(e){e.exports=function(e,n,t){return!n.eval(e[0],t)}},or:function(e){e.exports=function(e,n,t){for(var i=0;i<e.length;i++){var o=n.eval(e[i],t);if(o)return o}return e[e.length-1]}},and:function(e){e.exports=function(e,n,t){for(var i=0;i<e.length;i++){var o=n.eval(e[i],t);if(!o||i===e.length-1)return o}return void 0}},get:function(e){var n=e.exports=function(i,o,s){var r,a=e.require("util"),l=o.eval(i[0],s);if(s&&l in s?r=s[l]:t.isObject(o.value)&&l in o.value?r=o.value[l]:o.parent&&(r=n(i,o.parent)),i.length>1){var f=o.eval(i.slice(1),s);return a.getIn(r,f)}return r}},getGroupValues:function(e){e.exports=function(e,n,t){var i=n.eval(e[0],t),o=n.groupFields(i);return o.map(function(e){return e.value})}},getMeta:function(e){var n=e.require("util");e.exports=function(e,t,i){e=t.eval(e,i);var o=n.metaCacheKey(e[0],e[1]);return t.form.meta(o)}},sum:function(e){e.exports=function(e,n,t){for(var i=0,o=0;o<e.length;o++)i+=n.eval(e[o],t);return i}},forEach:function(e){e.exports=function(e,n,i){var o=e[0],s=n.eval(e[1],i),r=e[2],a=e[3];i=Object.create(i||{});for(var l=[],f=0;f<s.length;f++){var u=s[f];i[o]=u,(t.isUndefined(a)||n.eval(a,i))&&l.push(n.eval(r,i))}return l}},concat:o("concat"),split:o("split"),reverse:o("reverse"),join:o("join"),humanize:function(e){var n=e.require("util");e.exports=function(e,t,i){return n.humanize(t.eval(e[0],i))}},pick:i(t.pick),pluck:i(t.pluck)};t.each(s,function(e,t){n.exports["eval-function."+t]=e})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],36:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null;n.exports=function(e){var n=e.requireAllOf("eval-function"),i={};t.each(n,function(e,n){var t=n.substring(n.indexOf(".")+1);i[t]=e});var o=function(e){return e.length>0&&"@"===e[0][0]},s=function(e,n,t){var o=e[0].substring(1);try{return i[o](e.slice(1),n,t)}catch(s){if(!(o in i))throw new Error("Eval function "+o+" not defined.");throw s}},r=function(e,n,a){if(t.isArray(e))return o(e)?s(e,n,a):e.map(function(e){return r(e,n,a)});if(t.isObject(e)){var l={};return Object.keys(e).forEach(function(t){var i=r(e[t],n,a);"undefined"!=typeof i&&(l[t]=i)}),l}return t.isString(e)&&"="===e[0]?i.get([e.substring(1)],n,a):e};e.exports.evaluate=r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null;n.exports=function(e){var n={},i=e.exports,o=e.requireAll(e.config.routes);i.route=function(e,t,i){n[e]||(n[e]=[]),n[e].push({component:t,test:i})},o.forEach(function(e){i.route.apply(i,e)}),i.componentForField=function(i){var o=i.def.type;if(n[o]){var s=n[o],r=t.find(s,function(e){return!e.test||e.test(i)});if(r)return e.component(r.component)}if(e.hasComponent(o))return e.component(o);throw new Error("No component for field: "+JSON.stringify(i.def))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],38:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null,i={"object.default":["object","fieldset"],"string.choices":["string","select",function(e){return e.def.choices?!0:!1}],"string.tags":["string","pretty-textarea",function(e){return e.def.replaceChoices}],"string.single-line":["string","text",function(e){return 1===e.def.maxRows}],"string.default":["string","textarea"],"array.choices":["array","checkbox-list",function(e){return e.def.choices?!0:!1}],"array.default":["array","list"],"boolean.default":["boolean","select"],"number.default":["number","text"]};t.each(i,function(e,t){n.exports["field-route."+t]=function(n){n.exports=e}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],39:[function(e,n){"use strict";n.exports=function(e){var n=e.require("util"),t=e.exports,i={},o={};t.loadMeta=function(e,o,s){var r=n.metaCacheKey(o,s);i[r]||(i[r]=!0,t.loadAsyncFromSource(e,o,s))},t.loadAsyncFromSource=function(e,n,i,o){setTimeout(function(){t.loadFromSource(e,n,i)},o||0)},t.loadFromSource=function(e,t,s){var r=o[t];if(r){var a=n.metaCacheKey(t,s),l=r.call(null,s);if(l)if(l.then){var f=l.then(function(n){e.meta(a,n),i[a]=!1}),u=function(){i[a]=!1};f.catch?f.catch(u):f.fail(u)}else setTimeout(function(){e.meta(a,l),i[a]=!1},0);else i[a]=!1}else i[a]=!1},t.source=function(e,n){o[e]=n}}},{}],40:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null;n.exports=function(e){var n=e.exports;n.isBlank=function(e){return void 0===e||null===e||""===e},n.setIn=function(e,i,o){return t.isString(i)&&(i=[i]),0===i.length?o:1===i.length?(e[i[0]]=o,e):(e[i[0]]||(e[i[0]]={}),n.setIn(e[i[0]],i.slice(1),o),e)},n.removeIn=function(e,i){return t.isString(i)&&(i=[i]),0===i.length?null:1===i.length?(t.isArray(e)?t.isNumber(i[0])&&e.splice(i[0],1):t.isObject(e)&&delete e[i[0]],e):(e[i[0]]&&n.removeIn(e[i[0]],i.slice(1)),e)},n.getIn=function(e,i){return t.isString(i)&&(i=[i]),0===i.length?e:t.isObject(e)&&i[0]in e?n.getIn(e[i[0]],i.slice(1)):null},n.appendIn=function(e,i,o){var s=n.getIn(e,i);return t.isArray(s)&&s.push(o),e},n.moveIn=function(e,i,o,s){var r=n.getIn(e,i);if(t.isArray(r)){if(t.isNumber(o)&&t.isNumber(s)){var a=o,l=s;a!==l&&a>=0&&a<r.length&&l>=0&&l<r.length&&r.splice(l,0,r.splice(a,1)[0])}}else{var f=r[o];r[o]=r[s],r[s]=f}return e},n.copyValue=function(e){return JSON.parse(JSON.stringify(e))},n.deepCopy=function(e){if(t.isArray(e))return e.map(function(e){return n.deepCopy(e)});if(t.isObject(e)){var i={};return t.each(e,function(e,t){i[t]=n.deepCopy(e)}),i}return e},n.itemMatchesValue=function(e,n){var i=e.match;return i?t.every(t.keys(i),function(e){return t.isEqual(i[e],n[e])}):!0},n.fieldDefFromValue=function(e){var i={type:"json"};if(t.isString(e))i={type:"string"};else if(t.isNumber(e))i={type:"number"};else if(t.isArray(e)){var o=e.map(function(e,t){var i=n.fieldDefFromValue(e);return i.key=t,i});i={type:"array",fields:o}}else if(t.isObject(e)){var s=Object.keys(e).map(function(t){var i=n.fieldDefFromValue(e[t]);return i.key=t,i.label=n.humanize(t),i});i={type:"object",fields:s}}else t.isNull(e)&&(i={type:"null"});return i},n.humanize=e.config.humanize?e.require(e.config.humanize):function(e){return e=e.replace(/\{\{/g,""),e=e.replace(/\}\}/g,""),e.replace(/_/g," ").replace(/(\w+)/g,function(e){return e.charAt(0).toUpperCase()+e.slice(1)})},n.className=function(){var e=Array.prototype.slice.call(arguments,0);return e=e.filter(function(e){return e}),e.join(" ")},n.joinMetaKeys=function(e){return e.join("::")},n.splitMetaKey=function(e){return e.split("::")},n.metaCacheKey=function(e,n){return n=n||{},e+"::params("+JSON.stringify(n)+")"};var i=function(e,n){return n=n||"text",{type:n,value:e}};n.parseTextWithTags=function(e){e=e||"";var n=e.split(/{{(?!{)/),t=[];return""!==n[0]&&(t=[i(n[0])]),n=t.concat(n.slice(1).map(function(e){return e.indexOf("}}")>=0?[i(e.substring(0,e.indexOf("}}")),"tag"),i(e.substring(e.indexOf("}}")+2))]:i("{{"+e,"text")})),[].concat.apply([],n)},n.copyElementStyle=function(e,n){var t=window.getComputedStyle(e,"");if(""!==t.cssText)return void(n.style.cssText=t.cssText);for(var i=[],o=0;o<t.length;o++)i.push(t[o]+":"+t.getPropertyValue(t[o])+";");var s=i.join("");n.style.cssText=s};var o={isChrome:!1,isMozilla:!1,isOpera:!1,isIe:!1,isSafari:!1},s=navigator.userAgent;s.indexOf("Chrome")>-1?o.isChrome=!0:s.indexOf("Safari")>-1?o.isSafari=!0:s.indexOf("Opera")>-1?o.isOpera=!0:s.indexOf("Firefox")>-1?o.isMozilla=!0:s.indexOf("MSIE")>-1&&(o.isIe=!0),n.browser=o}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],41:[function(e,n){(function(t){"use strict";var i="undefined"!=typeof window?window.React:"undefined"!=typeof t?t.React:null,o=i.DOM,s="undefined"!=typeof window?window._:"undefined"!=typeof t?t._:null,r={},a={},l=0,f=function(e,n){if(r[e])throw new Error("Plugin "+e+" is already registered.");if(s.isArray(n))r[e]=[],n.forEach(function(n){f(n.name,n.plugin),r[e].push(n.name)});else if(s.isObject(n)&&!s.isFunction(n)){var t=e;r[t]=[],Object.keys(n).forEach(function(e){f(e,n[e]),r[t].push(e)})}else if(r[e]=n,e.indexOf(".")>0){var i=e.substring(0,e.indexOf("."));a[i]=a[i]||[],a[i].push(e)}},u={core:{formatic:["core.formatic"],form:["core.form-init","core.form","core.field"]},"core.form":{store:"store.memory"},"field-router":{routes:["field-routes"]},compiler:{compilers:["compiler.choices","compiler.lookup","compiler.types","compiler.prop-aliases"]},component:{props:["default-style"]}},c=function(e){e=s.extend({},e),s.keys(u).forEach(function(n){e[n]=s.extend({},u[n],e[n])});var n,t={},i=function(e,n){return this instanceof i?(this.exports={},this.config=n||{},void(this.name=e)):new i(e,n)};i.prototype.configValue=function(e,n){return"undefined"!=typeof this.config[e]?this.config[e]:n||""},i.prototype.require=function(e){return n.plugin(e)};var o;i.prototype.component=function(e){return o.component(e)},i.prototype.hasPlugin=function(e){return e in t||e in r},i.prototype.hasComponent=function(e){return this.hasPlugin("component."+e)},i.prototype.requireAll=function(e){return e||(e=[]),s.isArray(e)||(e=[e]),e=e.map(function(e){return s.isString(e)&&s.isArray(r[e])?r[e]:e}),e=s.flatten(e),e.map(function(e){return this.require(e)}.bind(this))},i.prototype.requireAllOf=function(e){var n={};return a[e]&&a[e].forEach(function(e){n[e]=this.require(e)}.bind(this)),n};var c=function(n,o){var a;if(s.isFunction(n)){var f=n;return s.isUndefined(f.__exports__)&&(l++,a=i("anonymous_plugin_"+l,o||{}),f(a),f.__exports__=a.exports),f.__exports__}if(s.isUndefined(t[n])){if(!o&&e[n]&&e[n].plugin)return c(e[n].plugin,e[n]||{});if(!r[n])throw new Error("Plugin "+n+" not found.");if(!s.isFunction(r[n]))throw new Error("Plugin "+n+" is not a function.");a=i(n,o||e[n]),r[n](a),t[n]=a.exports}return t[n]};n=function(e){return n.form(e)},n.register=function(e,t){return f(e,t),n},n.plugin=function(e){return c(e)};var d=c("core");return d(n),o=c("component"),n},d=function(){var e=s.toArray(arguments);e.forEach(function(e){var n=e[0],t=e[1];f(n,t)})};d(["core",e("./default/core")],["core.formatic",e("./core/formatic")],["core.form-init",e("./core/form-init")],["core.form",e("./core/form")],["core.field",e("./core/field")],["util",e("./default/util")],["compiler",e("./default/compiler")],["eval",e("./default/eval")],["eval-functions",e("./default/eval-functions")],["loader",e("./default/loader")],["field-router",e("./default/field-router")],["field-routes",e("./default/field-routes")],["compiler.choices",e("./compilers/choices")],["compiler.lookup",e("./compilers/lookup")],["compiler.types",e("./compilers/types")],["compiler.prop-aliases",e("./compilers/prop-aliases")],["store.memory",e("./store/memory")],["type.root",e("./types/root")],["type.string",e("./types/string")],["type.object",e("./types/object")],["type.boolean",e("./types/boolean")],["type.array",e("./types/array")],["type.json",e("./types/json")],["type.number",e("./types/number")],["component",e("./default/component")],["component.formatic",e("./components/formatic")],["component.root",e("./components/root")],["component.field",e("./components/field")],["component.label",e("./components/label")],["component.help",e("./components/help")],["component.sample",e("./components/sample")],["component.fieldset",e("./components/fieldset")],["component.text",e("./components/text")],["component.textarea",e("./components/textarea")],["component.select",e("./components/select")],["component.list",e("./components/list")],["component.list-control",e("./components/list-control")],["component.list-item",e("./components/list-item")],["component.list-item-value",e("./components/list-item-value")],["component.list-item-control",e("./components/list-item-control")],["component.item-choices",e("./components/item-choices")],["component.add-item",e("./components/add-item")],["component.remove-item",e("./components/remove-item")],["component.move-item-back",e("./components/move-item-back")],["component.move-item-forward",e("./components/move-item-forward")],["component.json",e("./components/json")],["component.checkbox-list",e("./components/checkbox-list")],["component.pretty-textarea",e("./components/pretty-textarea")],["mixin.click-outside",e("./mixins/click-outside")],["mixin.field",e("./mixins/field")],["mixin.input-actions",e("./mixins/input-actions")],["mixin.resize",e("./mixins/resize")],["mixin.undo-stack",e("./mixins/undo-stack")],["bootstrap-style",e("./plugins/bootstrap-style")],["default-style",e("./plugins/default-style")]);var p=function(e){var n=c(e);return i.createClass({displayName:"Formatic",statics:{config:p,form:n,plugin:n.plugin},getInitialState:function(){var e=this.props.form||this.props.defaultForm;return{form:e,field:e.field(),controlled:this.props.form?!0:!1}},componentDidMount:function(){var e=this.state.form;if(!e)throw new Error("Must supply a form or defaultForm.");this.state.controlled?e.once("change",this.onFormChanged):e.on("change",this.onFormChanged)},onFormChanged:function(){this.props.onChange&&this.props.onChange(this.props.form.val()),this.state.controlled||this.setState({field:this.state.form.field()})},componentWillUnmount:function(){var e=this.state.form;e&&e.off("change",this.onFormChanged)},componentWillReceiveProps:function(e){if(this.state.controlled){if(!e.form)throw new Error("Must supply a new form for a controlled component.");e.form.once("change",this.onFormChanged),this.setState({form:e.form,field:e.form.field()})}},render:function(){return o.div({className:"formatic"},this.state.field.component())}})};n.exports=p()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./compilers/choices":1,"./compilers/lookup":2,"./compilers/prop-aliases":3,"./compilers/types":4,"./components/add-item":5,"./components/checkbox-list":6,"./components/field":7,"./components/fieldset":8,"./components/formatic":9,"./components/help":10,"./components/item-choices":11,"./components/json":12,"./components/label":13,"./components/list":18,"./components/list-control":14,"./components/list-item":17,"./components/list-item-control":15,"./components/list-item-value":16,"./components/move-item-back":19,"./components/move-item-forward":20,"./components/pretty-textarea":21,"./components/remove-item":22,"./components/root":23,"./components/sample":24,"./components/select":25,"./components/text":26,"./components/textarea":27,"./core/field":28,"./core/form":30,"./core/form-init":29,"./core/formatic":31,"./default/compiler":32,"./default/component":33,"./default/core":34,"./default/eval":36,"./default/eval-functions":35,"./default/field-router":37,"./default/field-routes":38,"./default/loader":39,"./default/util":40,"./mixins/click-outside":42,"./mixins/field":43,"./mixins/input-actions":44,"./mixins/resize":45,"./mixins/undo-stack":46,"./plugins/bootstrap-style":47,"./plugins/default-style":48,"./store/memory":49,"./types/array":50,"./types/boolean":51,"./types/json":52,"./types/number":53,"./types/object":54,"./types/root":55,"./types/string":56}],42:[function(e,n){"use strict";var t=function(e,n){return e.parentNode===n?!0:e.parentNode===e.parentNode?!1:null===e.parentNode?!1:t(e.parentNode,n)},i=function(e,n){return e===n?!1:t(e,n)?!1:!0},o=function(e){Object.keys(this.clickOutsideHandlers).forEach(function(n){this.clickOutsideHandlers[n].length>0&&i(e.target,this.refs[n].getDOMNode())&&this.clickOutsideHandlers[n].forEach(function(e){e.call(this,n)}.bind(this))}.bind(this))};n.exports=function(e){e.exports={setOnClickOutside:function(e,n){this.clickOutsideHandlers[e]||(this.clickOutsideHandlers[e]=[]),this.clickOutsideHandlers[e].push(n)},componentDidMount:function(){this.clickOutsideHandlers={},document.addEventListener("click",o.bind(this))},componentWillUnmount:function(){this.clickOutsideHandlers={},document.removeEventListener("click",o.bind(this))}}}},{}],43:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null;n.exports=function(e){e.exports={loadNeededMeta:function(e){if(e.field&&e.field.form&&e.field.def.needsMeta&&e.field.def.needsMeta.length>0){var n=[];e.field.def.needsMeta.forEach(function(e){t.isArray(e)&&e.length>0&&(t.isArray(e[0])?e.forEach(function(e){n.push(e)}):n.push(e))}),0===n.length&&(n=[e.field.def.needsMeta]),n.forEach(function(n){n&&e.field.form.loadMeta.apply(e.field.form,n)})}},componentDidMount:function(){this.loadNeededMeta(this.props)},componentWillReceiveProps:function(e){this.loadNeededMeta(e)},componentWillUnmount:function(){}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(e,n){"use strict";n.exports=function(e){e.exports={onFocus:function(){},onBlur:function(){},onChange:function(){}}}},{}],45:[function(e,n){"use strict";var t=0,i={},o=0,s=null,r=function(){Object.keys(i).forEach(function(e){var n=i[e];if(n.clientWidth!==n.__prevClientWidth||n.clientHeight!==n.__prevClientHeight){n.__prevClientWidth=n.clientWidth,n.__prevClientHeight=n.clientHeight;var t=n.__resizeHandlers;t.forEach(function(e){e()})}},100)},a=function(e,n){null===s&&(s=setInterval(r,100)),"__resizeId"in e||(t++,e.__prevClientWidth=e.clientWidth,e.__prevClientHeight=e.clientHeight,e.__resizeId=t,o++,i[t]=e,e.__resizeHandlers=[]),e.__resizeHandlers.push(n)},l=function(e){if("__resizeId"in e){var n=e.__resizeId;delete e.__resizeId,delete e.__resizeHandlers,delete i[n],o--,1>o&&clearInterval(s)}},f=function(e,n){n(e)};n.exports=function(e){e.exports={componentDidMount:function(){this.onResizeWindow&&window.addEventListener("resize",this.onResizeWindow),this.resizeElementRefs={}},componentWillUnmount:function(){this.onResizeWindow&&window.removeEventListener("resize",this.onResizeWindow),Object.keys(this.resizeElementRefs).forEach(function(e){l(this.refs[e].getDOMNode())}.bind(this))},setOnResize:function(e,n){this.resizeElementRefs[e]||(this.resizeElementRefs[e]=!0),a(this.refs[e].getDOMNode(),f.bind(this,e,n))}}}},{}],46:[function(e,n){"use strict";var t={getInitialState:function(){return{undo:[],redo:[]}},snapshot:function(){var e=this.state.undo.concat(this.getStateSnapshot());"number"==typeof this.state.undoDepth&&e.length>this.state.undoDepth&&e.shift(),this.setState({undo:e,redo:[]})},hasUndo:function(){return this.state.undo.length>0},hasRedo:function(){return this.state.redo.length>0},redo:function(){this._undoImpl(!0)},undo:function(){this._undoImpl()},_undoImpl:function(e){var n,t=this.state.undo.slice(0),i=this.state.redo.slice(0);if(e){if(0===i.length)return;n=i.pop(),t.push(this.getStateSnapshot())}else{if(0===t.length)return;n=t.pop(),i.push(this.getStateSnapshot())}this.setStateSnapshot(n),this.setState({undo:t,redo:i})}};n.exports=function(e){e.exports=t}},{}],47:[function(e,n,t){(function(e){"use strict";var n="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null,i={field:{className:"form-group"},help:{className:"help-block"},sample:{className:"help-block"},text:{className:"form-control"},textarea:{className:"form-control"},"pretty-textarea":{className:"form-control"},json:{className:"form-control"},select:{className:"form-control"},"list-control":{className:"form-inline"},"list-item":{className:"well"},"item-choices":{className:"form-control"},"add-item":{className:"glyphicon glyphicon-plus",label:""},"remove-item":{className:"glyphicon glyphicon-remove",label:""},"move-item-back":{className:"glyphicon glyphicon-arrow-up",label:""},"move-item-forward":{className:"glyphicon glyphicon-arrow-down",label:""}};n.each(i,function(e,i){t["component-props."+i+".bootstrap"]=function(t){var o=t.require("util");t.exports=[i,function(t){n.isUndefined(e.className)||(t.className=o.className(t.className,e.className)),n.isUndefined(e.label)||(t.label=e.label)}]}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],48:[function(e,n,t){(function(e){"use strict";var n="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null,i={field:{},help:{},sample:{},text:{},textarea:{},"pretty-textarea":{},json:{},select:{},list:{},"list-control":{},"list-item-control":{},"list-item-value":{},"list-item":{},"item-choices":{},"add-item":{},"remove-item":{},"move-item-back":{},"move-item-forward":{}};n.each(i,function(e,n){t["component-props."+n+".default"]=function(e){var t=e.require("util");e.exports=[n,function(e){e.className=t.className(e.className,n)}]}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],49:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null;n.exports=function(e){var n=e.require("compiler"),i=e.require("util");e.exports=function(e,o,s){var r={};r.fields=[],r.templateMap={},r.value={},r.meta={};var a=function(e){r.fields=n.expandFields(e),r.fields=n.compileFields(r.fields),r.templateMap=n.templateMap(r.fields),r.fields=r.fields.filter(function(e){return!e.template})};s.fields&&a(s.fields),t.isUndefined(s.value)||(r.value=i.copyValue(s.value));var l=function(){o.emit("change",{value:r.value,meta:r.meta,fields:r.fields})};r.inflate=function(){var n=e.field();n.inflate(function(e,n){r.value=i.setIn(r.value,e,n)})};var f={setValue:function(e,n){t.isUndefined(n)&&(n=e,e=[]),0===e.length?(r.value=i.copyValue(n),r.inflate()):r.value=i.setIn(r.value,e,n),l()},removeValue:function(e){r.value=i.removeIn(r.value,e),l()},eraseValue:function(e){r.value=i.removeIn(r.value,e),l()},appendValue:function(e,n){r.value=i.appendIn(r.value,e,n),l()},moveValue:function(e,n,t){r.value=i.moveIn(r.value,e,n,t),l()},setFields:function(e){a(e),r.inflate(),l()},setMeta:function(e,n){r.meta[e]=n,l()}};return t.extend(r,f),r}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],50:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null;n.exports=function(e){e.exports.default=[],e.exports.fields=function(e){return t.isArray(e.value)?e.value.map(function(n,t){var i=e.itemForValue(n);return i.key=t,e.createChild(i)}):[]}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],51:[function(e,n){"use strict";n.exports=function(e){e.exports.default=!1,e.exports.compile=function(e){e.choices||(e.choices=[{value:!0,label:"Yes"},{value:!1,label:"No"}])}}},{}],52:[function(e,n){"use strict";n.exports=function(e){e.exports.default=null}},{}],53:[function(e,n){"use strict";n.exports=function(e){e.exports.default=0}},{}],54:[function(e,n){(function(e){"use strict";var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null;n.exports=function(e){var n=e.require("util");e.exports.default={},e.exports.fields=function(e){var i=[],o=e.value,s=t.keys(o);return e.def.fields&&(i=e.def.fields.map(function(i){var o=e.createChild(i);return n.isBlank(o.def.key)||(s=t.without(s,o.def.key)),o})),s.length>0&&s.forEach(function(t){var s=e.itemForValue(o[t]);s.label=n.humanize(t),s.key=t,i.push(e.createChild(s))}),i}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],55:[function(e,n){"use strict";n.exports=function(e){e.exports.fields=function(e){return e.form.store.fields.map(function(n){return e.createChild(n)})}}},{}],56:[function(e,n){"use strict";n.exports=function(e){e.exports.default=""}},{}],57:[function(e,n){"use strict";function t(e,n,t){this.fn=e,this.context=n,this.once=t||!1}function i(){}i.prototype._events=void 0,i.prototype.listeners=function(e){if(!this._events||!this._events[e])return[];for(var n=0,t=this._events[e].length,i=[];t>n;n++)i.push(this._events[e][n].fn);return i},i.prototype.emit=function(e,n,t,i,o,s){if(!this._events||!this._events[e])return!1;var r,a,l,f=this._events[e],u=f.length,c=arguments.length,d=f[0];if(1===u){switch(d.once&&this.removeListener(e,d.fn,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,n),!0;case 3:return d.fn.call(d.context,n,t),!0;case 4:return d.fn.call(d.context,n,t,i),!0;case 5:return d.fn.call(d.context,n,t,i,o),!0;case 6:return d.fn.call(d.context,n,t,i,o,s),!0}for(a=1,r=new Array(c-1);c>a;a++)r[a-1]=arguments[a];d.fn.apply(d.context,r)}else for(a=0;u>a;a++)switch(f[a].once&&this.removeListener(e,f[a].fn,!0),c){case 1:f[a].fn.call(f[a].context);break;case 2:f[a].fn.call(f[a].context,n);break;case 3:f[a].fn.call(f[a].context,n,t);break;default:if(!r)for(l=1,r=new Array(c-1);c>l;l++)r[l-1]=arguments[l];f[a].fn.apply(f[a].context,r)}return!0},i.prototype.on=function(e,n,i){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),this._events[e].push(new t(n,i||this)),this},i.prototype.once=function(e,n,i){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),this._events[e].push(new t(n,i||this,!0)),this},i.prototype.removeListener=function(e,n,t){if(!this._events||!this._events[e])return this;var i=this._events[e],o=[];if(n)for(var s=0,r=i.length;r>s;s++)i[s].fn!==n&&i[s].once!==t&&o.push(i[s]);return this._events[e]=o.length?o:null,this},i.prototype.removeAllListeners=function(e){return this._events?(e?this._events[e]=null:this._events={},this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.EventEmitter=i,i.EventEmitter2=i,i.EventEmitter3=i,"object"==typeof n&&n.exports&&(n.exports=i)},{}],formatic:[function(e,n){n.exports=e("./lib/formatic")},{"./lib/formatic":41}]},{},[])("formatic")});